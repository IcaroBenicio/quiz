<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz Avançado — Português
  </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Pequenos ajustes visuais adicionais */
    .option-btn { transition: transform .12s ease, box-shadow .12s ease, background-color .12s ease; }
    .option-btn:active { transform: scale(.98); }
    .progress-bar-inner { transition: width .45s cubic-bezier(.2,.9,.2,1); }
    .timer-bar { transition: width 1s linear; background: linear-gradient(90deg,#ffb86b,#ff6b9a); }
    .fade-in { animation: fadeIn .35s ease both; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px);} to { opacity: 1; transform: translateY(0);} }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-sky-50 to-amber-50 font-sans">

  <!-- Container central -->
  <div class="max-w-2xl mx-auto p-6">

    <!-- START SCREEN -->
    <section id="startScreen" class="bg-white rounded-xl shadow-lg p-8 text-center">
      <h1 class="text-3xl font-bold text-sky-700 mb-2">Quiz Avançado de Português</h1>
      <p class="text-gray-600 mb-6">Teste seus conhecimentos — perguntas aleatórias, tempo por pergunta e ranking local.</p>

      <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
        <label class="flex items-center gap-2 text-sm text-gray-700">
          <span>Tempo por pergunta</span>
          <select id="timePerQuestion" class="ml-2 rounded border px-2 py-1">
            <option value="15">15 s</option>
            <option value="20000" selected>20000 s</option>
            <option value="30">30 s</option>
          </select>
        </label>

        <button id="startBtn" class="mt-4 sm:mt-0 px-6 py-3 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition">
          Iniciar Quiz
        </button>

        <button id="resumeBtn" class="mt-4 sm:mt-0 px-4 py-2 bg-amber-400 text-white rounded-lg hover:bg-amber-500 transition hidden">
          Retomar
        </button>

        <button id="viewRankingBtn" class="mt-4 sm:mt-0 px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition">
          Ver Ranking
        </button>
      </div>
      <p class="text-xs text-gray-400 mt-4">O progresso é salvo localmente no seu navegador.</p>
    </section>

    <!-- QUIZ CARD -->
    <section id="quizCard" class="hidden mt-6 bg-white rounded-xl shadow-lg p-6 fade-in">
      <!-- topo: título + progress -->
      <div class="mb-4">
        <div class="flex items-center justify-between mb-2">
          <h2 id="cardTitle" class="text-xl font-semibold text-sky-700">Pergunta</h2>
          <div class="text-sm text-gray-600" id="progressText" aria-live="polite">Questão 1 de 5 (0%)</div>
        </div>

        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
          <div id="progressBar" class="h-3 progress-bar-inner bg-gradient-to-r from-sky-500 to-rose-400 rounded-full" style="width:0%"></div>
        </div>
      </div>

      <!-- Temporizador visual -->
      <div class="relative h-2 bg-gray-100 rounded-full overflow-hidden my-3">
        <div id="timerBar" class="timer-bar absolute left-0 top-0 h-full" style="width:100%"></div>
      </div>
      <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
        <div id="timerText">Tempo: 20000s</div>
        <div id="scoreMini">Acertos: 0</div>
      </div>

      <!-- Pergunta & opções -->
      <div id="questionBox" class="mb-4">
        <p id="questionText" class="text-lg text-gray-800 font-medium">Pergunta aparece aqui</p>
      </div>

      <div id="options" class="grid gap-3"></div>

      <!-- ação -->
      <div class="flex items-center justify-between mt-6">
        <button id="skipBtn" class="px-4 py-2 rounded-md border border-gray-200 text-gray-700 hover:bg-gray-50">Pular</button>
        <div class="flex items-center gap-3">
          <button id="nextBtn" class="px-5 py-2 bg-sky-600 text-white rounded-md hidden">Próxima</button>
          <button id="quitBtn" class="px-4 py-2 rounded-md border border-red-100 text-red-600 hover:bg-red-50">Sair</button>
        </div>
      </div>
    </section>

    <!-- RESULT SCREEN -->
    <section id="resultCard" class="hidden mt-6 bg-white rounded-xl shadow-lg p-6 text-center">
      <h3 id="resultTitle" class="text-2xl font-bold text-sky-700">Resultado</h3>
      <p id="resultMsg" class="mt-2 text-gray-700"></p>
      <p class="mt-2 text-lg">Pontuação: <strong id="finalScore">0</strong> / <span id="totalQ">0</span></p>

      <div id="wrongList" class="mt-4 text-left"></div>

      <div class="mt-6 flex flex-col sm:flex-row gap-3 items-center justify-center">
        <button id="shareBtn" class="px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600">Compartilhar</button>
        <button id="tryAgainBtn" class="px-4 py-2 bg-emerald-500 text-white rounded-md hover:bg-emerald-600">Jogar de novo</button>
        <button id="backHomeBtn" class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-100">Voltar</button>
      </div>
    </section>

    <!-- RANKING modal simples -->
    <section id="rankingCard" class="hidden mt-6 bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-xl font-semibold text-sky-700">Ranking (últimas pontuações)</h3>
      <ul id="rankingList" class="mt-4 text-gray-700"></ul>
      <div class="mt-4 flex gap-3">
        <button id="clearRankingBtn" class="px-3 py-2 bg-red-400 text-white rounded-md hover:bg-red-500">Limpar histórico</button>
        <button id="closeRankingBtn" class="px-3 py-2 bg-gray-200 rounded-md hover:bg-gray-100">Fechar</button>
      </div>
    </section>

  </div>

  <script>
  /**********************
   * Configurações / dados
   **********************/
  const STORAGE_KEY = 'quiz_state_v1';
  const HISTORY_KEY = 'quiz_history_v1';

  // perguntas originais (pode ampliar)
  const ALL_QUESTIONS = [
       {
      "text": "Em qual alternativa o verbo está na voz passiva analítica?",
      "options": [
        "O atleta feriu-se durante o treino.",
        "O projeto foi aprovado pela comissão.",
        "Reformam-se apartamentos antigos.",
        "O governo resolveu o problema rapidamente."
      ],
      "correct": 1
    },
    {
      "text": "Ao transformar a frase 'O aluno fez a tarefa.' para a voz passiva sintética, a forma correta é:",
      "options": [
        "A tarefa foi feita pelo aluno.",
        "Fez-se a tarefa pelo aluno.",
        "Fez-se a tarefa.",
        "Fizeram-se as tarefas."
      ],
      "correct": 2
    },
    {
      "text": "O 'se' atua como Índice de Indeterminação do Sujeito (IIS) em qual das frases?",
      "options": [
        "Vende-se casa na praia.",
        "Trabalha-se muito neste escritório.",
        "Resolveram-se os problemas da equipe.",
        "O réu entregou-se à polícia."
      ],
      "correct": 1
    },
    {
      "text": "Qual a voz do verbo em 'Os vizinhos cumprimentaram-se calorosamente na rua'?",
      "options": [
        "Voz ativa",
        "Voz passiva analítica",
        "Voz reflexiva",
        "Voz reflexiva recíproca"
      ],
      "correct": 3
    },
    {
      "text": "Qual a forma correta da frase 'Os alunos prepararam a festa' na voz passiva analítica?",
      "options": [
        "Preparou-se a festa pelos alunos.",
        "A festa foi preparada pelos alunos.",
        "Os alunos foram preparados para a festa.",
        "Prepara-se a festa."
      ],
      "correct": 1
    },
    {
      "text": "A voz do verbo em 'O problema parecia insolúvel para a equipe' é:",
      "options": [
        "Voz ativa",
        "Voz passiva",
        "Voz reflexiva",
        "Voz indeterminada"
      ],
      "correct": 0
    },
    {
      "text": "Qual é a classificação da voz verbal na frase 'Os candidatos submeteram-se ao exame rigoroso'?",
      "options": [
        "Voz ativa com objeto direto reflexivo",
        "Voz passiva sintética",
        "Voz reflexiva",
        "Voz passiva analítica"
      ],
      "correct": 2
    },
    {
      "text": "Qual a principal característica do Discurso Indireto Livre?",
      "options": [
        "Uso de aspas e travessão para marcar a fala do personagem.",
        "A fala do personagem é reproduzida pelo narrador, sem mistura de vozes.",
        "Mistura da voz do narrador e do personagem, sem o uso de verbos de elocução explícitos ou pontuação marcante.",
        "O narrador apenas relata os fatos, sem incluir pensamentos do personagem."
      ],
      "correct": 2
    },
    {
      "text": "Ao transformar a frase em Discurso Indireto: 'O funcionário perguntou: 'Posso sair mais cedo hoje?'', a forma correta é:",
      "options": [
        "O funcionário perguntou se podia sair mais cedo hoje.",
        "O funcionário perguntou que se podia sair mais cedo naquele dia.",
        "O funcionário perguntou se podia sair mais cedo naquele dia.",
        "O funcionário perguntou se eu poderia sair mais cedo naquele dia."
      ],
      "correct": 2
    },
    {
      "text": "Identifique a única frase que está em Discurso Direto.",
      "options": [
        "O orador explicou que a crise econômica era passageira.",
        "O orador: a crise econômica era passageira. (pensou a plateia)",
        "O orador afirmou: 'A crise econômica é passageira.'",
        "A crise econômica, sim, passageira, disse o orador para os presentes."
      ],
      "correct": 2
    },
    {
      "text": "Na passagem para o Discurso Indireto, o Futuro do Presente ('Eu viajarei amanhã.') se transforma em:",
      "options": [
        "Presente do Indicativo",
        "Futuro do Pretérito",
        "Pretérito Perfeito",
        "Pretérito Mais-que-perfeito"
      ],
      "correct": 1
    },
    {
      "text": "A frase 'Ele não aguentava mais! Tinha que sair daquele lugar.' (pensamento do personagem inserido na narrativa sem pontuação de diálogo) é um exemplo de:",
      "options": [
        "Discurso Indireto Simples",
        "Discurso Direto",
        "Citação direta",
        "Discurso Indireto Livre"
      ],
      "correct": 3
    },
    {
      "text": "Qual dos verbos de elocução (ou dicendi) seria mais adequado para introduzir uma dúvida no Discurso Indireto?",
      "options": [
        "Afirmar",
        "Gritar",
        "Indagar",
        "Sussurrar"
      ],
      "correct": 2
    },
    {
      "text": "Ao converter a ordem 'O professor disse: 'Façam o exercício agora!'' para o Discurso Indireto, qual a forma correta?",
      "options": [
        "O professor disse para os alunos que fizessem o exercício agora.",
        "O professor ordenou que eles fizessem o exercício naquele momento.",
        "O professor disse que eles farão o exercício agora.",
        "O professor perguntou se eles fariam o exercício naquele momento."
      ],
      "correct": 1
    },
    {
      "text": "O que a Progressão com Tópico Constante (ou Linear) realiza em um parágrafo?",
      "options": [
        "O rema de uma oração se torna o tema da oração seguinte.",
        "Repetição da mesma informação sem adicionar nada novo.",
        "O mesmo tema é mantido, mas a cada oração uma nova informação (rema) é adicionada sobre ele.",
        "A apresentação de uma ideia principal no final do parágrafo."
      ],
      "correct": 2
    },
    {
      "text": "Qual a principal função dos elementos de *coesão referencial* em um texto?",
      "options": [
        "Estabelecer a relação de sentido lógico (causa, consequência, oposição) entre as frases.",
        "Ligar as orações através de conjunções e advérbios conectivos.",
        "Evitar repetições desnecessárias, retomando termos já citados através de pronomes, sinônimos ou elipses.",
        "Garantir que as ideias apresentadas não sejam contraditórias e mantenham a lógica."
      ],
      "correct": 2
    },
    {
      "text": "A ausência de Progressão Textual, onde um texto repete a mesma ideia de forma circular sem introduzir informações novas, é um problema de:",
      "options": [
        "Incoerência",
        "Coesão sequencial",
        "Circularidade ou Tópico Nulo",
        "Vagueza"
      ],
      "correct": 2
    },
    {
      "text": "Qual conectivo é essencial para estabelecer uma *relação de causa* na coesão sequencial?",
      "options": [
        "Portanto",
        "Contudo",
        "Visto que",
        "Embora"
      ],
      "correct": 2
    },
    {
      "text": "Em 'João gosta de História. Esta disciplina é fundamental para a cidadania.', o termo 'Esta disciplina' é um mecanismo de coesão que retoma 'História'. Que tipo de coesão é essa?",
      "options": [
        "Coesão sequencial",
        "Coesão referencial por substituição",
        "Coesão por elipse",
        "Coesão por repetição"
      ],
      "correct": 1
    },
    {
      "text": "Qual a relação entre coerência e progressão textual?",
      "options": [
        "Coerência é a progressão textual em textos narrativos; a coesão é em textos dissertativos.",
        "A coerência se relaciona apenas à gramática do texto, enquanto a progressão se refere ao sentido.",
        "A coerência é uma condição para a progressão; um texto incoerente não pode progredir de forma lógica.",
        "São termos sinônimos, ambos se referindo à organização das orações no parágrafo."
      ],
      "correct": 2
    },
    {
      "text": "A Progressão com Tópicos Derivados (ou em cadeia) é mais adequada para qual objetivo textual?",
      "options": [
        "Desenvolver a ideia central de um parágrafo por meio de detalhes sucessivos.",
        "Apresentar uma lista de fatos ou argumentos de forma desordenada.",
        "Explicar um processo, uma sequência cronológica de eventos ou uma definição que se desdobra.",
        "Mudar radicalmente o tema do texto, introduzindo um novo parágrafo."
      ],
      "correct": 2
    },
    {
      "text": "Qual adjetivo foi derivado de um substantivo?",
      "options": [
        "Compreensível",
        "Limpável",
        "Maternal",
        "Vidente"
      ],
      "correct": 2
    },
    {
      "text": "O adjetivo 'perigoso' foi derivado de qual palavra primitiva e qual classe gramatical?",
      "options": [
        "Perigo (Substantivo)",
        "Perigar (Verbo)",
        "Perigavelmente (Advérbio)",
        "Perigo (Adjetivo Primitivo)"
      ],
      "correct": 0
    },
    {
      "text": "Qual adjetivo foi derivado do verbo 'falar' e expressa a qualidade de algo que pode ser falado?",
      "options": [
        "Falatório",
        "Falange",
        "Infalível",
        "Falável"
      ],
      "correct": 3
    },
    {
      "text": "A palavra 'incerteza' foi formada a partir do adjetivo 'certo'. Qual classe gramatical do derivado 'incerteza'?",
      "options": [
        "Advérbio",
        "Verbo",
        "Substantivo Abstrato",
        "Adjetivo"
      ],
      "correct": 2
    },
    {
      "text": "Qual dos adjetivos abaixo é um adjetivo pátrio (ou gentílico) derivado?",
      "options": [
        "Milenar",
        "Americano",
        "Fraternal",
        "Amarelado"
      ],
      "correct": 1
    },
    {
      "text": "O adjetivo 'desleal' é formado a partir do adjetivo 'leal' pelo processo de:",
      "options": [
        "Derivação Sufixal",
        "Composição por Justaposição",
        "Derivação Prefixal",
        "Derivação Parassintética"
      ],
      "correct": 2
    },
    {
      "text": "Qual dos adjetivos compostos a seguir mantém invariável o segundo elemento?",
      "options": [
        "Olhos verde-escuros",
        "Camisas azul-celeste",
        "Móveis castanho-claros",
        "Ternos cinza-claros"
      ],
      "correct": 1
    },
    {
      "text": "Um Período Composto por Coordenação é caracterizado por orações que são:",
      "options": [
        "Dependentes sintaticamente uma da outra.",
        "Sintaticamente independentes, unidas ou não por uma conjunção coordenativa.",
        "Orações que funcionam como termos da outra (sujeito, objeto, adjunto, etc.).",
        "Sempre separadas apenas por vírgulas, sem o uso de conectivos."
      ],
      "correct": 1
    },
    {
      "text": "Qual a classificação da oração coordenada sublinhada em: 'Não só estudei o tema, *como também fiz um resumo*.'?",
      "options": [
        "Coordenada Sindética Alternativa",
        "Coordenada Sindética Explicativa",
        "Coordenada Sindética Aditiva",
        "Coordenada Sindética Adversativa"
      ],
      "correct": 2
    },
    {
      "text": "O Período Composto por Coordenação 'Ou você me diz a verdade, ou eu saio imediatamente.' é formado por orações coordenadas sindéticas:",
      "options": [
        "Adversativas",
        "Alternativas",
        "Conclusivas",
        "Explicativas"
      ],
      "correct": 1
    },
    {
      "text": "Qual a classificação correta da oração: 'Cumpra suas tarefas, *pois o prazo está acabando*.'?",
      "options": [
        "Coordenada Sindética Aditiva",
        "Coordenada Sindética Conclusiva",
        "Coordenada Sindética Explicativa",
        "Coordenada Assindética"
      ],
      "correct": 2
    },
    {
      "text": "Na frase 'Ele trabalha, estuda, lê bastante.', as orações são coordenadas:",
      "options": [
        "Sindéticas Conclusivas",
        "Sindéticas Aditivas",
        "Assindéticas",
        "Sindéticas Explicativas"
      ],
      "correct": 2
    },
    {
      "text": "A conjunção 'entretanto' pertence a qual grupo de conjunções coordenativas?",
      "options": [
        "Aditivas",
        "Explicativas",
        "Conclusivas",
        "Adversativas"
      ],
      "correct": 3
    },
    {
      "text": "Qual das opções abaixo contém um Período Composto por Coordenação, e não Subordinação?",
      "options": [
        "É fundamental que você revise a matéria.",
        "Acredito que ele passará na prova.",
        "Quero estudar mais, mas não tenho tempo.",
        "Os alunos, que estavam cansados, foram embora mais cedo."
      ],
      "correct": 2
    },
    {
      "text": "Qual o principal objetivo de se fazer uma *paráfrase* de um texto?",
      "options": [
        "Alterar a ideia original do autor para expressar uma nova opinião.",
        "Resumir o texto, mantendo a linguagem técnica original.",
        "Reproduzir o sentido do texto original com outras palavras, geralmente para torná-lo mais claro ou acessível.",
        "Copiar trechos do texto original, inserindo aspas e a fonte."
      ],
      "correct": 2
    },
    {
      "text": "Paráfrase e Resumo se diferenciam principalmente em relação ao(à):",
      "options": [
        "Fidelidade ao texto original, pois apenas a paráfrase exige fidelidade.",
        "Manutenção da forma original do texto (estrutura e pontuação).",
        "Tamanho do texto final: a paráfrase pode manter ou expandir, o resumo obrigatoriamente reduz.",
        "Uso de conectivos, que é exclusivo da paráfrase."
      ],
      "correct": 2
    },
    {
      "text": "Qual das opções é a melhor paráfrase para a frase: 'A persistência é o caminho do êxito.'?",
      "options": [
        "O êxito é o resultado inevitável da persistência.",
        "É necessário esforço, pois o sucesso não vem facilmente.",
        "A insistência e a constância nos conduzem ao sucesso e à realização.",
        "Somente os persistentes chegam ao final do caminho."
      ],
      "correct": 2
    },
    {
      "text": "O que a paráfrase de um texto literário *não* deve fazer, em relação ao original?",
      "options": [
        "Tornar o texto mais simples e de fácil leitura.",
        "Perder a forma original do texto (métrica, rima, ritmo).",
        "Alterar o tom ou a emoção central do poema ou da narrativa.",
        "Usar o vocabulário do próprio autor em algumas passagens."
      ],
      "correct": 2
    },
    {
      "text": "Qual a principal aplicação da paráfrase no contexto acadêmico e de estudos?",
      "options": [
        "Provar que você encontrou a fonte original do texto.",
        "Demonstrar a compreensão de um conceito complexo, reescrevendo-o com suas próprias palavras.",
        "Reduzir o número de páginas do trabalho para atender a um limite de palavras.",
        "Adicionar comentários e críticas pessoais à obra de outro autor."
      ],
      "correct": 1
    },
    {
      "text": "Qual é a paráfrase mais adequada para o provérbio: 'De grão em grão, a galinha enche o papo.'?",
      "options": [
        "A paciência é importante, pois a galinha precisa de tempo para comer.",
        "A galinha enche seu papo comendo muitos grãos, um de cada vez.",
        "Os grandes objetivos são alcançados por meio de esforços pequenos e contínuos.",
        "O papo da galinha não deve ser enchido de uma vez só."
      ],
      "correct": 2
    },
    {
      "text": "A paráfrase é um recurso importante para evitar qual problema na escrita acadêmica?",
      "options": [
        "Erros de concordância verbal.",
        "O uso excessivo de adjetivos derivados.",
        "A falta de progressão textual.",
        "O plágio, ao reescrever ideias de outros autores sem copiar a forma."
      ],
      "correct": 3
    },
    {
      "text": "Em interpretação textual, o que se entende por *inferência*?",
      "options": [
        "A identificação da tese ou ideia principal do autor.",
        "A dedução ou conclusão de uma informação que não está explícita, mas é sugerida pelo texto.",
        "A reprodução de um trecho do texto com as mesmas palavras.",
        "A análise da estrutura gramatical e do vocabulário utilizado."
      ],
      "correct": 1
    },
    {
      "text": "Qual a diferença crucial entre *compreensão* e *interpretação* de texto?",
      "options": [
        "A compreensão é subjetiva e a interpretação é objetiva.",
        "A compreensão analisa o que está *implícito* e a interpretação o que está *explícito*.",
        "A compreensão foca no que está *escrito* (o texto em si); a interpretação foca no que se pode *deduzir* (a relação do texto com o contexto).",
        "A compreensão é aplicada a textos narrativos e a interpretação a textos dissertativos."
      ],
      "correct": 2
    },
    {
      "text": "O que o leitor deve buscar para determinar a *intencionalidade* ou o *objetivo* de um texto?",
      "options": [
        "A função sintática de todos os termos gramaticais.",
        "A presença ou ausência de verbos na voz passiva.",
        "A ideia central, o tipo de linguagem e o público-alvo a que se destina.",
        "O número exato de orações coordenadas e subordinadas."
      ],
      "correct": 2
    },
    {
      "text": "Qual a função da linguagem predominante em um artigo de opinião que busca convencer o leitor a respeito de um ponto de vista?",
      "options": [
        "Função Referencial",
        "Função Emotiva",
        "Função Conativa (ou Apelativa)",
        "Função Fática"
      ],
      "correct": 2
    },
    {
      "text": "Ao analisar um texto, a *ideia central* é:",
      "options": [
        "A primeira oração do primeiro parágrafo, que sempre é o tópico frasal.",
        "O tema geral, a tese ou o ponto principal sobre o qual todas as outras informações se articulam.",
        "Qualquer argumento que o autor utilize para sustentar sua opinião.",
        "Uma opinião do leitor sobre o assunto abordado."
      ],
      "correct": 1
    },
    {
      "text": "Qual estratégia é mais eficaz para a identificação do tema e das ideias centrais em um texto longo?",
      "options": [
        "Contar o número de parágrafos e dividir pelo número de frases.",
        "Buscar as palavras-chave e seus sinônimos que se repetem com frequência ao longo dos parágrafos.",
        "Prestar atenção apenas nas conjunções coordenativas adversativas e conclusivas.",
        "Focar apenas nas informações contidas nos parênteses e nas notas de rodapé."
      ],
      "correct": 1
    },
    {
      "text": "Em um texto dissertativo-argumentativo, o que se espera que a *tese* do autor cumpra?",
      "options": [
        "Ser uma simples descrição do cenário apresentado.",
        "Apresentar a opinião do autor sobre o tema, um ponto de vista a ser defendido ao longo do texto.",
        "Fazer um resumo de todas as ideias secundárias do desenvolvimento.",
        "Utilizar exclusivamente orações coordenadas assindéticas para expressar a opinião."
      ],
      "correct": 1
    },
    {
      "text": "Em um texto, a presença de advérbios como 'infelizmente', 'certamente', 'aparentemente' (elementos de modalização) serve para:",
      "options": [
        "Garantir a progressão com tópico constante.",
        "Revelar a perspectiva, a atitude ou o grau de certeza do locutor sobre o que está sendo dito.",
        "Criar um período composto por coordenação, unindo orações independentes.",
        "Alterar o tempo verbal da voz ativa para a voz passiva."
      ],
      "correct": 1
    },
    {
      "text": "Ao converter a frase 'O técnico se arrependeu de sua escolha' para a voz ativa, o pronome 'se' mantém a função de partícula apassivadora ou índice de indeterminação do sujeito?",
      "options": [
        "Partícula Apacivadora, pois 'arrepender' é transitivo direto.",
        "Índice de Indeterminação do Sujeito, pois o sujeito é desconhecido.",
        "Não se aplica, pois 'arrepender-se' é um verbo pronominal inerente, e a frase já está na voz ativa.",
        "É um objeto direto reflexivo, o que a torna passiva."
      ],
      "correct": 2
    },
    {
      "text": "Na frase 'Procedeu-se à investigação dos fatos', o 'se' é corretamente classificado como:",
      "options": [
        "Partícula Apacivadora (PA), pois o objeto é direto.",
        "Pronome Reflexivo Recíproco (PRR), indicando ação mútua.",
        "Índice de Indeterminação do Sujeito (IIS), devido ao verbo ser transitivo indireto (VTI).",
        "Objeto Direto, pois 'proceder' é um verbo de ligação."
      ],
      "correct": 2
    },
    {
      "text": "A voz passiva analítica 'A decisão será revisada pelo comitê' tem como voz passiva sintética correspondente a forma:",
      "options": [
        "Revisam-se a decisão pelo comitê.",
        "Revisar-se-á a decisão.",
        "O comitê revisará a decisão.",
        "Revisou-se a decisão."
      ],
      "correct": 1
    },
    {
      "text": "Qual das alternativas abaixo apresenta um verbo na voz reflexiva recíproca, mas com sentido de reciprocidade indireta?",
      "options": [
        "Os atletas feriram-se gravemente no jogo.",
        "Os noivos trocaram-se presentes caros.",
        "Os colegas abraçaram-se após a vitória.",
        "Os rivais cumprimentaram-se protocolarmente."
      ],
      "correct": 1
    },
    {
      "text": "O único caso de 'se' que não permite a conversão para a voz passiva analítica é o que atua como:",
      "options": [
        "Pronome Apassivador com Objeto Direto (OD).",
        "Pronome Reflexivo com Verbo Transitivo Direto.",
        "Índice de Indeterminação do Sujeito (IIS) com Verbo Transitivo Indireto (VTI).",
        "Partícula integrante do verbo (PIV)."
      ],
      "correct": 2
    },
    {
      "text": "Qual a conversão mais precisa para o Discurso Indireto da frase: 'O líder: 'Se eu puder, resolverei isso antes que o dia termine.''?",
      "options": [
        "O líder disse que, se ele puder, resolverá aquilo antes que o dia termine.",
        "O líder avisou que, se pudesse, resolveria aquilo antes que o dia terminasse.",
        "O líder disse que, se podia, resolveria isso antes que o dia terminasse.",
        "O líder informou que, se puder, ele resolverá isso antes que o dia termine."
      ],
      "correct": 1
    },
    {
      "text": "Identifique a passagem que demonstra claramente o uso do Discurso Indireto Livre:",
      "options": [
        "Ele se afastou. Aquele lugar era insuportável, não havia mais o que fazer ali.",
        "Ele se afastou e pensou: 'Aquele lugar é insuportável, não há mais o que fazer aqui.'",
        "Ele se afastou e disse que aquele lugar era insuportável e não havia mais o que fazer ali.",
        "Ele se afastou, pois o lugar, segundo sua opinião, era insuportável."
      ],
      "correct": 0
    },
    {
      "text": "O verbo de elocução 'sugerir' introduz o discurso indireto. Qual o modo verbal mais comum e adequado para a oração subordinada que segue?",
      "options": [
        "Infinitivo (Ex: 'sugeriu fazer').",
        "Indicativo (Ex: 'sugeriu que fazia').",
        "Subjuntivo (Ex: 'sugeriu que fizesse').",
        "Imperativo (Ex: 'sugeriu faça')."
      ],
      "correct": 2
    },
    {
      "text": "Na conversão de uma ordem ou pedido (Imperativo) para o Discurso Indireto, qual tempo e modo verbal são utilizados?",
      "options": [
        "Pretérito Perfeito do Indicativo.",
        "Futuro do Presente do Indicativo.",
        "Pretérito Imperfeito do Subjuntivo.",
        "Presente do Subjuntivo."
      ],
      "correct": 2
    },
    {
      "text": "A transposição da frase 'O réu negou: 'Nunca estive naquele local.'' para o Discurso Indireto deve resultar em:",
      "options": [
        "O réu negou que nunca esteve naquele local.",
        "O réu negou que jamais teria estado naquele local.",
        "O réu negou que jamais estivera naquele local.",
        "O réu negou que tinha estado naquele local."
      ],
      "correct": 2
    },
    {
      "text": "A Progressão com Tópicos Derivados (em cadeia) é a mais indicada para qual tipo de desenvolvimento textual?",
      "options": [
        "Apresentação de uma série de argumentos desconectados.",
        "Definição de um conceito por meio da desintegração de seus componentes.",
        "Manutenção de um único sujeito e a atribuição de novas características a ele.",
        "Retomada da mesma ideia com reformulações superficiais (circularidade)."
      ],
      "correct": 1
    },
    {
      "text": "Em um texto, a repetição excessiva de substantivos ou sintagmas nominais, sem o uso de pronomes, sinônimos ou elipse, compromete o mecanismo de:",
      "options": [
        "Coerência sintática.",
        "Coesão referencial por substituição.",
        "Progressão com tópico derivado.",
        "Coesão sequencial por conjunção."
      ],
      "correct": 1
    },
    {
      "text": "O que a ausência do 'tópico frasal' e a repetição de um mesmo 'rema' nas orações de um parágrafo podem indicar?",
      "options": [
        "Um texto bem estruturado em progressão linear.",
        "Um problema de circularidade (tópico nulo).",
        "Uma coesão sequencial bem definida.",
        "Um texto com predominância da função conativa."
      ],
      "correct": 1
    },
    {
      "text": "Qual das seguintes frases demonstra uma progressão textual por *Tópico Constante*?",
      "options": [
        "O presidente propôs uma reforma. Esta reforma foi criticada pela oposição.",
        "Os dados foram analisados. A análise demonstrou resultados surpreendentes. Tais resultados levaram à mudança de estratégia.",
        "O livro de Machado de Assis é complexo. O autor utiliza a ironia. O narrador é um narrador cínico.",
        "A seca atingiu a região. A falta de água levou à perda das colheitas. Por isso, a população migrou."
      ],
      "correct": 2
    },
    {
      "text": "Qual conectivo de *coesão sequencial* introduz uma oração coordenada que não pode ter sua posição alterada no período sem perda de sentido?",
      "options": [
        "Contudo (adversativa).",
        "Ou (alternativa).",
        "Portanto (conclusiva).",
        "Pois (explicativa, antes do verbo)."
      ],
      "correct": 3
    },
    {
      "text": "Qual adjetivo composto, derivado de um substantivo, NÃO deve ser flexionado em número?",
      "options": [
        "Tecidos rubro-negros.",
        "Cabelos castanho-claros.",
        "Vestidos amarelo-ouro.",
        "Estofados verde-escuros."
      ],
      "correct": 2
    },
    {
      "text": "O adjetivo 'subterrâneo' é classificado, quanto à derivação, como:",
      "options": [
        "Sufixal, a partir do substantivo 'terra'.",
        "Prefixal, a partir do substantivo 'sub'.",
        "Parassintética, a partir do substantivo 'terra'.",
        "Sufixal e Prefixal, a partir do adjetivo 'terreno'."
      ],
      "correct": 2
    },
    {
      "text": "Qual dos adjetivos abaixo foi derivado por processo *prefixal e sufixal*, mas NÃO por parassíntese?",
      "options": [
        "Desumano",
        "Envelhecido",
        "Desalmado",
        "Desleal"
      ],
      "correct": 2
    },
    {
      "text": "O adjetivo 'capaz' tem sua forma mais comum de substantivo abstrato derivado em:",
      "options": [
        "Capacitário (Adjetivo).",
        "Capacidade (Substantivo).",
        "Capabilismo (Substantivo).",
        "Capável (Adjetivo)."
      ],
      "correct": 1
    },
    {
      "text": "Qual adjetivo derivado exprime a ideia de 'sem' (privação ou ausência)?",
      "options": [
        "Territorial (Sufixo '-ial').",
        "Medroso (Sufixo '-oso').",
        "Imoral (Prefixo 'i-').",
        "Duvidoso (Sufixo '-oso')."
      ],
      "correct": 2
    },
    {
      "text": "Qual é a relação de sentido exata na coordenada sindética do período: 'Não me chamaram à reunião, tampouco me enviaram a ata.'?",
      "options": [
        "Alternância.",
        "Oposição.",
        "Adição com ideia de negação ou exclusão.",
        "Conclusão."
      ],
      "correct": 2
    },
    {
      "text": "Na frase: 'Estou cansado; logo, não irei à festa', o termo 'logo' atua como:",
      "options": [
        "Advérbio de tempo, assinalando a consequência.",
        "Conjunção coordenativa conclusiva, ligando orações independentes.",
        "Conjunção subordinativa consecutiva, iniciando uma oração subordinada.",
        "Pronome relativo, retomando o termo anterior."
      ],
      "correct": 1
    },
    {
      "text": "Em qual período a oração coordenada sindética explicativa pode ser substituída por uma oração subordinada causal sem alteração de sentido?",
      "options": [
        "Não chore, pois o show já vai começar.",
        "Ele estava doente, pois não veio trabalhar hoje.",
        "Ora estuda, ora trabalha, ora descansa.",
        "O clima estava seco, mas conseguimos irrigar a plantação."
      ],
      "correct": 1
    },
    {
      "text": "O que distingue a oração 'Estude mais' (assindética) de 'Estude mais, que o exame está próximo' (sindética explicativa)?",
      "options": [
        "A primeira é uma oração coordenada, e a segunda é subordinada adverbial.",
        "A primeira é uma oração absoluta, e a segunda é coordenada.",
        "A segunda oração adiciona uma explicação ou justificativa à ordem da primeira.",
        "A segunda oração estabelece uma relação de oposição."
      ],
      "correct": 2
    },
    {
      "text": "Identifique a única oração que estabelece uma relação de coordenação e não subordinação:",
      "options": [
        "Embora fosse tarde, ele continuou o trabalho.",
        "Ele prometeu que voltaria logo.",
        "Ele se atrasou, contudo, chegou a tempo de assinar.",
        "Viveremos melhor à medida que o tempo passar."
      ],
      "correct": 2
    },
    {
      "text": "Qual das opções é a paráfrase mais adequada para a metáfora: 'A arte é o espelho que a alma reflete.'?",
      "options": [
        "A alma é um reflexo da arte que a pessoa consome.",
        "A arte tem a função de ser o espelho da realidade e da sociedade.",
        "A expressão artística serve como uma manifestação visível e sincera dos sentimentos e pensamentos interiores.",
        "O artista utiliza a arte para criar espelhos de sua própria alma."
      ],
      "correct": 2
    },
    {
      "text": "Qual a principal falha na fidelidade de uma paráfrase em relação ao texto original?",
      "options": [
        "A alteração do vocabulário, tornando o texto mais técnico.",
        "A manutenção da estrutura sintática original.",
        "A mudança do tom do autor (por exemplo, de crítico para elogioso).",
        "A citação da fonte original, o que a torna um resumo."
      ],
      "correct": 2
    },
    {
      "text": "Um leitor encontra a informação explícita: '15% dos entrevistados apoiam a medida X'. A conclusão 'a maioria não apoia a medida X' é um exemplo de:",
      "options": [
        "Compreensão literal.",
        "Paráfrase.",
        "Inferência (Interpretação).",
        "Extrapolação incorreta."
      ],
      "correct": 2
    },
    {
      "text": "Em um dicionário, o verbete que explica o significado de uma palavra é um exemplo de texto com predomínio da função da linguagem:",
      "options": [
        "Conativa (foco no receptor).",
        "Emotiva (foco no emissor).",
        "Referencial (foco no contexto).",
        "Metalinguística (foco no código)."
      ],
      "correct": 3
    },
    {
      "text": "O que caracteriza uma *extrapolação* no processo de interpretação textual, tornando-a um erro?",
      "options": [
        "A manutenção da ideia original, mas com o uso de novas palavras.",
        "A dedução lógica de uma informação implícita, mas evidente no texto.",
        "A introdução de ideias externas ou a conclusão de algo não sugerido ou não contido no universo do texto.",
        "A leitura literal e superficial, sem análise profunda."
      ],
      "correct": 2
    },
        {
      "text": "Qual das frases abaixo apresenta o verbo na *voz passiva sintética*, mas com o sujeito paciente indeterminado?",
      "options": [
        "Reviu-se o acordo rapidamente.",
        "Não se deve mentir em juízo.",
        "Assistiu-se aos jogos com entusiasmo.",
        "Faziam-se os pagamentos pela manhã."
      ],
      "correct": 2
    },
    {
      "text": "Se a frase 'O gerente deu as instruções à equipe.' for convertida para a voz passiva analítica com foco no *Objeto Indireto*, qual seria a forma resultante?",
      "options": [
        "As instruções foram dadas à equipe pelo gerente.",
        "O gerente foi dado de instruções pela equipe.",
        "A equipe foi dada as instruções pelo gerente.",
        "A equipe recebeu as instruções do gerente."
      ],
      "correct": 2
    },
    {
      "text": "A voz verbal em 'O réu se declarou inocente no tribunal' é classificada como:",
      "options": [
        "Voz passiva sintética.",
        "Voz reflexiva, pois o pronome atua como Objeto Direto (se = a si mesmo).",
        "Voz ativa com pronome reflexivo inerente.",
        "Voz ativa com o 'se' como Partícula Expletiva (de realce)."
      ],
      "correct": 1
    },
    {
      "text": "O único pronome oblíquo átono que pode atuar como *sujeito* (em voz ativa) em uma construção de Discurso Indireto é:",
      "options": [
        "O 'me' (Ex: 'Ouvi-me falar').",
        "O 'o' (Ex: 'Viu-o sair').",
        "O 'lhe' (Ex: 'Mandou-lhe chegar').",
        "O 'se' (Ex: 'Acreditou-se ser verdade')."
      ],
      "correct": 1
    },
    {
      "text": "Qual a conversão mais fiel e correta para o Discurso Indireto da frase: 'O professor advertiu: 'Cuidado, é possível que haja novas provas amanhã.''?",
      "options": [
        "O professor advertiu para ter cuidado, que era possível haver novas provas amanhã.",
        "O professor advertiu que era possível que tivessem novas provas no dia seguinte.",
        "O professor advertiu que tivessem cuidado, pois era possível que houvesse novas provas no dia seguinte.",
        "O professor advertiu que era possível que haja novas provas no dia seguinte."
      ],
      "correct": 2
    },
    {
      "text": "A frase 'O autor não percebeu. Ele era um tolo!' inserida na narração, mantendo a entonação original do narrador (crítica/juízo), é um exemplo de Discurso:",
      "options": [
        "Direto Incompleto.",
        "Indireto Livre com Modalização.",
        "Indireto com Verbo de Elocução Implícito.",
        "Direto com Elipse."
      ],
      "correct": 1
    },
    {
      "text": "Qual oração coordenada estabelece uma relação de *oposição qualitativa* (e não meramente quantitativa) e exige vírgula antes da conjunção?",
      "options": [
        "Não apenas comeu, mas também bebeu em excesso.",
        "O time jogou bem, todavia, o resultado foi desfavorável.",
        "Trabalha muito, ou seja, tem garantido o seu futuro.",
        "Ele não fala nem escreve o português corretamente."
      ],
      "correct": 1
    },
    {
      "text": "No período 'Não te afastes, *que* a situação exige cautela', a oração sublinhada é corretamente classificada como:",
      "options": [
        "Coordenada Sindética Aditiva, com sentido de reforço.",
        "Coordenada Sindética Explicativa, introduzindo uma justificativa para a ordem.",
        "Subordinada Substantiva Apositiva, complementando o sentido.",
        "Subordinada Adverbial Causal, com vírgula de deslocamento."
      ],
      "correct": 1
    },
    {
      "text": "A frase 'O estudo do Latim é a base. A base da nossa língua é o Latim. O Latim é importante.' apresenta falha de progressão por:",
      "options": [
        "Coesão Sequencial Inadequada.",
        "Tópico Constante Excessivo (Monotonia).",
        "Tópico Nulo (Circularidade).",
        "Falta de coerência interna."
      ],
      "correct": 2
    },
    {
      "text": "A progressão textual que depende da *referência catafórica* para introduzir seu tema principal é mais comum em textos de natureza:",
      "options": [
        "Narrativa (contos e crônicas).",
        "Expositiva ou científica (listas, demonstrações).",
        "Poética (lírica e subjetiva).",
        "Argumentativa (dissertações com tese implícita)."
      ],
      "correct": 1
    },
    {
      "text": "A transição de 'tema' para 'rema' em 'A corrupção é um mal. Esse mal afeta a confiança. A confiança perdida dificulta a estabilidade.' é um exemplo de progressão por:",
      "options": [
        "Tópico Constante.",
        "Tópicos Derivados (em cadeia).",
        "Salto de Tópico (Tópico Nulo).",
        "Progressão Paralela."
      ],
      "correct": 1
    },
    {
      "text": "Qual é a classificação morfológica e o processo de derivação do vocábulo 'incansável'?",
      "options": [
        "Advérbio, Derivação Sufixal.",
        "Substantivo, Derivação Prefixal.",
        "Adjetivo, Derivação Prefixal e Sufixal (NÃO é parassíntese).",
        "Adjetivo, Derivação Parassintética."
      ],
      "correct": 2
    },
    {
      "text": "Qual dos adjetivos compostos exige a flexão apenas do último elemento, mesmo que o primeiro seja um adjetivo:",
      "options": [
        "Sapatos azul-marinho.",
        "Alianças dourado-claras.",
        "Relações afro-brasileiras.",
        "Tênis verde-musgo."
      ],
      "correct": 2
    },
    {
      "text": "A palavra 'envelhecer' é formada pelo processo de Parassíntese a partir do adjetivo 'velho'. Qual adjetivo abaixo é formado pelo mesmo processo (prefixo + radical + sufixo, simultaneamente)?",
      "options": [
        "Desleal.",
        "Amedrontador.",
        "Subterrâneo.",
        "Desumano."
      ],
      "correct": 1
    },
    {
      "text": "A principal falha de uma paráfrase malfeita de um texto científico é:",
      "options": [
        "O uso excessivo de termos técnicos do original.",
        "A manutenção da estrutura sintática original (risco de plágio).",
        "O uso de verbos de elocução inadequados.",
        "A simplificação excessiva que compromete a precisão conceitual do original."
      ],
      "correct": 3
    },
    {
      "text": "O que caracteriza a *inferência válida* em interpretação textual?",
      "options": [
        "É a leitura literal e explícita do texto (compreensão).",
        "É a opinião do leitor sobre o tema, sem relação com o texto.",
        "É a conclusão logicamente deduzida das premissas contidas no texto, mesmo que implícita.",
        "É a introdução de conhecimento de mundo que contradiz as informações do texto."
      ],
      "correct": 2
    },
    {
      "text": "Em um editorial jornalístico que critica veementemente uma decisão governamental, a função da linguagem que coexiste e se sobrepõe à Função Referencial (informação) é a:",
      "options": [
        "Metalinguística.",
        "Fática.",
        "Emotiva (foco no emissor e sua atitude).",
        "Conativa (foco no receptor e sua persuasão)."
      ],
      "correct": 2
    },
    {
      "text": "A diferença entre um argumento e a *ideia central* (tese) de um texto argumentativo reside no fato de que:",
      "options": [
        "A tese é um fato comprovado, e o argumento é uma opinião.",
        "A tese é o ponto de vista a ser defendido; os argumentos são as razões que a sustentam.",
        "O argumento é sempre apresentado na introdução, e a tese, no desenvolvimento.",
        "A tese é implícita, e o argumento é sempre explícito."
      ],
      "correct": 1
    },
    {
      "text": "A extrapolação é um erro de interpretação que ocorre quando o leitor:",
      "options": [
        "Limita-se a repetir o que está no texto sem analisar.",
        "Deduza algo não escrito, mas implicitamente contido no texto.",
        "Distorce o sentido original do texto para adequá-lo à sua opinião.",
        "Utiliza apenas a Função Conativa da Linguagem."
      ],
      "correct": 2
    },
    {
      "text": "A coesão referencial por *elipse* é um desafio para o leitor porque exige que ele:",
      "options": [
        "Conecte orações de mesmo valor sintático usando conjunções.",
        "Identifique a omissão de um termo já mencionado por meio do contexto sintático e semântico.",
        "Substitua um termo por um sinônimo ou hiperônimo para evitar a repetição.",
        "Analise a progressão de tópicos derivados ao longo do parágrafo."
      ],
      "correct": 1
    }


    // adicione mais perguntas aqui se quiser
  ];

  /**********************
   * Estado e elementos
   **********************/
  let questions = []; // embaralhadas
  let timePerQuestion = 20;
  let currentIndex = 0;
  let score = 0;
  let wrongs = [];
  let timerInterval = null;
  let remaining = 0;
  let paused = false;

  // elementos DOM
  const startScreen = document.getElementById('startScreen');
  const startBtn = document.getElementById('startBtn');
  const resumeBtn = document.getElementById('resumeBtn');
  const viewRankingBtn = document.getElementById('viewRankingBtn');
  const timePerQuestionSel = document.getElementById('timePerQuestion');

  const quizCard = document.getElementById('quizCard');
  const questionText = document.getElementById('questionText');
  const optionsEl = document.getElementById('options');
  const progressBar = document.getElementById('progressBar');
  const progressText = document.getElementById('progressText');
  const timerBar = document.getElementById('timerBar');
  const timerText = document.getElementById('timerText');
  const scoreMini = document.getElementById('scoreMini');
  const nextBtn = document.getElementById('nextBtn');
  const skipBtn = document.getElementById('skipBtn');
  const quitBtn = document.getElementById('quitBtn');

  const resultCard = document.getElementById('resultCard');
  const resultMsg = document.getElementById('resultMsg');
  const finalScore = document.getElementById('finalScore');
  const totalQ = document.getElementById('totalQ');
  const wrongList = document.getElementById('wrongList');
  const shareBtn = document.getElementById('shareBtn');
  const tryAgainBtn = document.getElementById('tryAgainBtn');
  const backHomeBtn = document.getElementById('backHomeBtn');

  const rankingCard = document.getElementById('rankingCard');
  const rankingList = document.getElementById('rankingList');
  const viewRanking = document.getElementById('viewRankingBtn');
  const clearRankingBtn = document.getElementById('clearRankingBtn');
  const closeRankingBtn = document.getElementById('closeRankingBtn');

  // botão retomar
  const resumeButton = document.getElementById('resumeBtn');

  /**********************
   * Utilitários
   **********************/
  function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

  function saveState(){
    const state = { questions, timePerQuestion, currentIndex, score, wrongs, remaining, paused };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function loadState(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return null;
    try { return JSON.parse(raw); } catch(e){ return null; }
  }

  function clearState(){
    localStorage.removeItem(STORAGE_KEY);
  }

  function addHistoryEntry(sc){
    const raw = localStorage.getItem(HISTORY_KEY);
    const arr = raw ? JSON.parse(raw) : [];
    arr.unshift({ score: sc, total: questions.length, date: new Date().toISOString() });
    // guarda só últimos 20
    localStorage.setItem(HISTORY_KEY, JSON.stringify(arr.slice(0,20)));
  }

  function getHistory(){ const raw = localStorage.getItem(HISTORY_KEY); return raw ? JSON.parse(raw) : []; }

  /**********************
   * Tela Inicial / start
   **********************/
  function showStartScreen(){
    startScreen.classList.remove('hidden');
    quizCard.classList.add('hidden');
    resultCard.classList.add('hidden');
    rankingCard.classList.add('hidden');

    // se existe estado salvo, habilita retomar
    const st = loadState();
    if(st) resumeBtn.classList.remove('hidden'); else resumeBtn.classList.add('hidden');
  }

  // inicia um novo jogo
  function initNewQuiz(){
    timePerQuestion = Number(timePerQuestionSel.value) || 20;
    questions = shuffleArray([...ALL_QUESTIONS]).map(q => ({
      text: q.text,
      // vamos embaralhar opções mantendo index correto
      options: shuffleArray(q.options.map((opt, idx) => ({ opt, idx })))
    })).map(q=>{
      // recuperar index da correta
      // find original correct index (we'll map original ALL_QUESTIONS by text)
      const original = ALL_QUESTIONS.find(originalQ => originalQ.text === q.text);
      const correctIdxOriginal = ALL_QUESTIONS.indexOf(original) >=0 ? original.correct : 0;
      // but above mapping is tricky; simpler approach: during map maintain correct value via matching:
      return q;
    });

    // simpler rebuild: ensure correct mapping by rebuilding from ALL_QUESTIONS with shuffle
    questions = shuffleArray(ALL_QUESTIONS).map(item => {
      const shuffledOptions = shuffleArray(item.options.map((opt, idx)=> ({ opt, idx })));
      // determine index in shuffledOptions where idx === item.correct
      const correctShuffledIndex = shuffledOptions.findIndex(o => o.idx === item.correct);
      return {
        text: item.text,
        options: shuffledOptions.map(o=>o.opt),
        correct: correctShuffledIndex
      };
    });

    currentIndex = 0;
    score = 0;
    wrongs = [];
    remaining = timePerQuestion;
    paused = false;
    saveState();
    openQuiz();
  }

  function openQuiz(){
    startScreen.classList.add('hidden');
    quizCard.classList.remove('hidden');
    resultCard.classList.add('hidden');
    rankingCard.classList.add('hidden');
    renderQuestion();
    startTimer();
  }

  /**********************
   * Retomar (carregar estado salvo)
   **********************/
  function tryResume(){
    const st = loadState();
    if(!st) return alert('Nenhum progresso salvo.');
    // recuperar perguntas (já vêm do storage)
    questions = st.questions;
    timePerQuestion = st.timePerQuestion || 20;
    currentIndex = st.currentIndex || 0;
    score = st.score || 0;
    wrongs = st.wrongs || [];
    remaining = st.remaining || timePerQuestion;
    paused = !!st.paused;
    timePerQuestionSel.value = timePerQuestion;
    openQuiz();
    resumeBtn.classList.add('hidden');
  }

  /**********************
   * Render / lógica
   **********************/
  function renderQuestion(){
    // verificar índice
    if(currentIndex >= questions.length){
      finishQuiz();
      return;
    }

    const q = questions[currentIndex];
    questionText.textContent = q.text;
    optionsEl.innerHTML = '';

    q.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.className = 'option-btn option-button bg-gray-50 border border-transparent rounded-xl px-4 py-3 text-left w-full flex items-center gap-3';
      btn.innerHTML = `<span class="flex-1">${opt}</span><span class="ml-2 opacity-0 transition-opacity" aria-hidden="true"></span>`;
      btn.dataset.index = i;

      // teclado: Enter / Space
      btn.addEventListener('keydown', e => { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); } });

      btn.addEventListener('click', () => {
        // se já desabilitado
        if(btn.classList.contains('disabled')) return;
        handleAnswer(i, btn);
      });

      optionsEl.appendChild(btn);
    });

    updateProgressUI();
    scoreMini.textContent = `Acertos: ${score}`;
    timerText.textContent = `Tempo: ${remaining}s`;
    timerBar.style.width = `${(remaining/timePerQuestion)*100}%`;
    nextBtn.classList.add('hidden');
  }

  function updateProgressUI(){
    const pct = Math.round((currentIndex / questions.length) * 100);
    progressBar.style.width = pct + '%';
    progressText.textContent = `Questão ${Math.min(currentIndex+1, questions.length)} de ${questions.length} (${pct}%)`;
  }

  /**********************
   * Temporizador
   **********************/
  function startTimer(){
    stopTimer();
    timerInterval = setInterval(() => {
      if(paused) return;
      remaining--;
      if(remaining < 0) remaining = 0;
      timerText.textContent = `Tempo: ${remaining}s`;
      timerBar.style.width = `${(remaining/timePerQuestion)*100}%`;
      saveState();

      if(remaining === 0){
        // tempo esgotou = contar como erro e avançar
        markTimeout();
      }
    }, 1000);
  }

  function stopTimer(){
    if(timerInterval) { clearInterval(timerInterval); timerInterval = null; }
  }

  function markTimeout(){
    // revelar resposta correta e marcar erro
    const q = questions[currentIndex];
    const optionsButtons = [...optionsEl.children];
    optionsButtons.forEach((btn, i) => {
      btn.classList.add('disabled');
      if(i === q.correct){
        btn.classList.add('correct');
        const icon = document.createElement('span'); icon.textContent = ' ✅'; btn.appendChild(icon);
      }
    });
    // registrar como errado
    wrongs.push({ question: q.text, chosen: null, correct: q.options[q.correct] });
    nextBtn.classList.remove('hidden');
    stopTimer();
    saveState();
  }

  /**********************
   * Resposta do usuário
   **********************/
  function handleAnswer(selectedIndex, btn){
    const q = questions[currentIndex];
    const buttons = [...optionsEl.children];
    // desabilita todos
    buttons.forEach(b => { b.classList.add('disabled'); });
    // marca seleção
    if(selectedIndex === q.correct){
      btn.classList.add('correct');
      btn.style.background = '#dcfce7';
      score++;
      const tick = document.createElement('span'); tick.textContent = ' ✅'; tick.className='ml-2'; btn.appendChild(tick);
    } else {
      btn.classList.add('incorrect');
      btn.style.background = '#fee2e2';
      const cross = document.createElement('span'); cross.textContent = ' ❌'; cross.className='ml-2'; btn.appendChild(cross);
      // mostra o correto
      const correctBtn = buttons[q.correct];
      if(correctBtn){
        correctBtn.classList.add('correct');
        const tick = document.createElement('span'); tick.textContent = ' ✅'; tick.className='ml-2'; correctBtn.appendChild(tick);
      }
      wrongs.push({ question: q.text, chosen: q.options[selectedIndex], correct: q.options[q.correct] });
    }

    // pequeno delay para salvar e permitir ver o feedback
    stopTimer();
    nextBtn.classList.remove('hidden');
    saveState();
  }

  /**********************
   * navegar próximas / pular / sair
   **********************/
  nextBtn.addEventListener('click', () => {
    currentIndex++;
    remaining = timePerQuestion;
    saveState();
    if(currentIndex < questions.length){
      renderQuestion();
      startTimer();
    } else {
      finishQuiz();
    }
  });

  skipBtn.addEventListener('click', () => {
    // marcar como pulo = tratado como errada sem chosen
    const q = questions[currentIndex];
    wrongs.push({ question: q.text, chosen: null, correct: q.options[q.correct] });
    currentIndex++;
    remaining = timePerQuestion;
    saveState();
    if(currentIndex < questions.length){
      renderQuestion();
      startTimer();
    } else {
      finishQuiz();
    }
  });

  quitBtn.addEventListener('click', () => {
    if(confirm('Deseja realmente sair e salvar seu progresso para retomar depois?')) {
      saveState();
      showStartScreen();
    }
  });

  /**********************
   * Finalizar quiz / resultados
   **********************/
  function finishQuiz(){
    stopTimer();
    saveState(); // guarda estado final
    // mostrar resultados
    quizCard.classList.add('hidden');
    resultCard.classList.remove('hidden');

    finalScore.textContent = score;
    totalQ.textContent = questions.length;
    // mensagem personalizada
    const pct = Math.round((score / questions.length) * 100);
    let msg = '';
    if(pct === 100) msg = 'Perfeito! Você domina o assunto. 👏';
    else if(pct >= 80) msg = 'Excelente! Muito bem.';
    else if(pct >= 50) msg = 'Bom trabalho — continue praticando.';
    else msg = 'Não desanime — prática leva à melhora!';

    resultMsg.textContent = msg;

    // lista de erradas
    wrongList.innerHTML = '';
    if(wrongs.length){
      const h = document.createElement('h4'); h.className='font-semibold text-red-600'; h.textContent = 'Questões que você errou:'; wrongList.appendChild(h);
      wrongs.forEach(w => {
        const div = document.createElement('div');
        div.className = 'mt-2 p-3 bg-red-50 rounded';
        div.innerHTML = `<p class="text-sm"><strong>❓ ${w.question}</strong></p>
                         <p class="text-xs text-red-600">Sua resposta: ${w.chosen ?? '— (não respondeu)'}</p>
                         <p class="text-xs text-green-700">Resposta certa: ${w.correct}</p>`;
        wrongList.appendChild(div);
      });
    } else {
      const p = document.createElement('p'); p.className='text-green-700 font-semibold'; p.textContent = '🎉 Você não errou nenhuma questão!';
      wrongList.appendChild(p);
    }

    // salvar histórico e limpar estado salvo
    addHistoryEntry(score);
    clearState();
    renderRanking(); // atualiza ranking na memória
  }

  /**********************
   * Compartilhar / ranking
   **********************/
  shareBtn.addEventListener('click', async () => {
    const text = `Fiz o Quiz e acertei ${score} de ${questions.length} perguntas!`;
    if(navigator.share){
      try { await navigator.share({ title:'Meu resultado', text }); }
      catch(e){ alert('Compartilhamento cancelado.'); }
    } else {
      // fallback: link whatsapp
      const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`;
      window.open(url, '_blank');
    }
  });

  tryAgainBtn.addEventListener('click', () => { initNewQuiz(); });
  backHomeBtn.addEventListener('click', () => { showStartScreen(); });

  viewRankingBtn.addEventListener('click', () => {
    startScreen.classList.add('hidden');
    quizCard.classList.add('hidden');
    resultCard.classList.add('hidden');
    rankingCard.classList.remove('hidden');
    renderRanking();
  });

  closeRankingBtn.addEventListener('click', () => {
    showStartScreen();
  });

  clearRankingBtn.addEventListener('click', () => {
    if(confirm('Limpar todo o histórico de pontuações?')) {
      localStorage.removeItem(HISTORY_KEY);
      renderRanking();
    }
  });

  function renderRanking(){
    const hist = getHistory();
    rankingList.innerHTML = '';
    if(!hist.length){
      rankingList.innerHTML = '<p class="text-gray-500">Nenhuma pontuação registrada.</p>';
      return;
    }
    hist.forEach((h, i) => {
      const li = document.createElement('li');
      const date = new Date(h.date);
      li.className = 'py-2 border-b last:border-b-0';
      li.innerHTML = `<strong>#${i+1}</strong> — <span class="ml-2 font-semibold">${h.score}/${h.total}</span> <span class="ml-2 text-xs text-gray-500">(${date.toLocaleString()})</span>`;
      rankingList.appendChild(li);
    });
  }
  
  /**********************
   * Início / eventos de UI
   **********************/
  startBtn.addEventListener('click', () => { initNewQuiz(); });
  resumeBtn.addEventListener('click', tryResume);
  timePerQuestionSel.addEventListener('change', (e) => { /* só muda na nova sessão */ });

  // checar se existe estado salvo para habilitar retomar
  (function init(){
    const st = loadState();
    if(st) resumeBtn.classList.remove('hidden'); else resumeBtn.classList.add('hidden');
    renderRanking();
  })();

  </script>
</body>
</html>





























































