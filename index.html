<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz Avançado — Geografia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Pequenos ajustes visuais adicionais */
    .option-btn { transition: transform .12s ease, box-shadow .12s ease, background-color .12s ease; }
    .option-btn:active { transform: scale(.98); }
    .progress-bar-inner { transition: width .45s cubic-bezier(.2,.9,.2,1); }
    .timer-bar { transition: width 1s linear; background: linear-gradient(90deg,#ffb86b,#ff6b9a); }
    .fade-in { animation: fadeIn .35s ease both; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px);} to { opacity: 1; transform: translateY(0);} }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-sky-50 to-amber-50 font-sans">

  <!-- Container central -->
  <div class="max-w-2xl mx-auto p-6">

    <!-- START SCREEN -->
    <section id="startScreen" class="bg-white rounded-xl shadow-lg p-8 text-center">
      <h1 class="text-3xl font-bold text-sky-700 mb-2">Quiz Avançado de Geografia</h1>
      <p class="text-gray-600 mb-6">Teste seus conhecimentos — perguntas aleatórias, tempo por pergunta e ranking local.</p>

      <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
        <label class="flex items-center gap-2 text-sm text-gray-700">
          <span>Tempo por pergunta</span>
          <select id="timePerQuestion" class="ml-2 rounded border px-2 py-1">
            <option value="15">15 s</option>
            <option value="20" selected>20 s</option>
            <option value="30">30 s</option>
          </select>
        </label>

        <button id="startBtn" class="mt-4 sm:mt-0 px-6 py-3 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition">
          Iniciar Quiz
        </button>

        <button id="resumeBtn" class="mt-4 sm:mt-0 px-4 py-2 bg-amber-400 text-white rounded-lg hover:bg-amber-500 transition hidden">
          Retomar
        </button>

        <button id="viewRankingBtn" class="mt-4 sm:mt-0 px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition">
          Ver Ranking
        </button>
      </div>
      <p class="text-xs text-gray-400 mt-4">O progresso é salvo localmente no seu navegador.</p>
    </section>

    <!-- QUIZ CARD -->
    <section id="quizCard" class="hidden mt-6 bg-white rounded-xl shadow-lg p-6 fade-in">
      <!-- topo: título + progress -->
      <div class="mb-4">
        <div class="flex items-center justify-between mb-2">
          <h2 id="cardTitle" class="text-xl font-semibold text-sky-700">Pergunta</h2>
          <div class="text-sm text-gray-600" id="progressText" aria-live="polite">Questão 1 de 5 (0%)</div>
        </div>

        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
          <div id="progressBar" class="h-3 progress-bar-inner bg-gradient-to-r from-sky-500 to-rose-400 rounded-full" style="width:0%"></div>
        </div>
      </div>

      <!-- Temporizador visual -->
      <div class="relative h-2 bg-gray-100 rounded-full overflow-hidden my-3">
        <div id="timerBar" class="timer-bar absolute left-0 top-0 h-full" style="width:100%"></div>
      </div>
      <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
        <div id="timerText">Tempo: 20s</div>
        <div id="scoreMini">Acertos: 0</div>
      </div>

      <!-- Pergunta & opções -->
      <div id="questionBox" class="mb-4">
        <p id="questionText" class="text-lg text-gray-800 font-medium">Pergunta aparece aqui</p>
      </div>

      <div id="options" class="grid gap-3"></div>

      <!-- ação -->
      <div class="flex items-center justify-between mt-6">
        <button id="skipBtn" class="px-4 py-2 rounded-md border border-gray-200 text-gray-700 hover:bg-gray-50">Pular</button>
        <div class="flex items-center gap-3">
          <button id="nextBtn" class="px-5 py-2 bg-sky-600 text-white rounded-md hidden">Próxima</button>
          <button id="quitBtn" class="px-4 py-2 rounded-md border border-red-100 text-red-600 hover:bg-red-50">Sair</button>
        </div>
      </div>
    </section>

    <!-- RESULT SCREEN -->
    <section id="resultCard" class="hidden mt-6 bg-white rounded-xl shadow-lg p-6 text-center">
      <h3 id="resultTitle" class="text-2xl font-bold text-sky-700">Resultado</h3>
      <p id="resultMsg" class="mt-2 text-gray-700"></p>
      <p class="mt-2 text-lg">Pontuação: <strong id="finalScore">0</strong> / <span id="totalQ">0</span></p>

      <div id="wrongList" class="mt-4 text-left"></div>

      <div class="mt-6 flex flex-col sm:flex-row gap-3 items-center justify-center">
        <button id="shareBtn" class="px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600">Compartilhar</button>
        <button id="tryAgainBtn" class="px-4 py-2 bg-emerald-500 text-white rounded-md hover:bg-emerald-600">Jogar de novo</button>
        <button id="backHomeBtn" class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-100">Voltar</button>
      </div>
    </section>

    <!-- RANKING modal simples -->
    <section id="rankingCard" class="hidden mt-6 bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-xl font-semibold text-sky-700">Ranking (últimas pontuações)</h3>
      <ul id="rankingList" class="mt-4 text-gray-700"></ul>
      <div class="mt-4 flex gap-3">
        <button id="clearRankingBtn" class="px-3 py-2 bg-red-400 text-white rounded-md hover:bg-red-500">Limpar histórico</button>
        <button id="closeRankingBtn" class="px-3 py-2 bg-gray-200 rounded-md hover:bg-gray-100">Fechar</button>
      </div>
    </section>

  </div>

  <script>
  /**********************
   * Configurações / dados
   **********************/
  const STORAGE_KEY = 'quiz_state_v1';
  const HISTORY_KEY = 'quiz_history_v1';

  // perguntas originais (pode ampliar)
  const ALL_QUESTIONS = [
     {
                text: 'A presença da Cordilheira dos Andes na região metropolitana de La Paz (Bolívia) influenciou a criação de um moderno sistema de:',
                options: ['Metrô subterrâneo', 'Teleféricos aéreos', 'Bondes elétricos', 'Monotrilho de superfície'],
                correct: 1
            },
            {
                text: 'A principal causa da violência nos países da América Latina, segundo o texto da página 94, está ligada à:',
                options: ['Corrupção política generalizada', 'Desigualdade social e falta de oportunidades', 'Deficiência no sistema educacional', 'Excessiva industrialização'],
                correct: 1
            },
            {
                text: 'A urbanização desordenada na América do Sul tem como consequência o crescimento de moradias precárias em áreas de risco, como:',
                options: ['Centros comerciais', 'Áreas rurais planas', 'Encostas de morros e margens de rios', 'Condomínios de alto padrão'],
                correct: 2
            },
            {
                text: 'O termo "favela", que hoje designa assentamentos precários no Brasil, teve origem com a ocupação do Morro da Providência por:',
                options: ['Imigrantes europeus', 'Mineradores de ouro', 'Ex-combatentes da Guerra de Canudos', 'Trabalhadores rurais do Sul'],
                correct: 2
            },
            {
                text: 'Em 2022, na América Latina e Caribe, o percentual da população que vivia em condições de extrema pobreza era de, aproximadamente:',
                options: ['5%', '50%', '13%', '32%'],
                correct: 2
            },
            {
                text: 'O que o texto da página 96 identifica como um dos principais problemas da infraestrutura de transportes na maioria dos países da América do Sul?',
                options: ['Excesso de trens de alta velocidade', 'Prioridade à circulação de pedestres', 'O serviço público é gerenciado por empresas privadas e é caro e de má qualidade', 'Investimento maciço em hidrovias'],
                correct: 2
            },
            {
                text: 'A crise hídrica, a poluição e a impermeabilização excessiva do solo nas cidades latino-americanas são exemplos de problemas urbanos de ordem:',
                options: ['Social', 'Política', 'Econômica', 'Ambiental'],
                correct: 3
            },
            {
                text: 'O Movimento dos Trabalhadores Sem Teto (MTST) e o Movimento Passe Livre (MPL) são exemplos de:',
                options: ['Partidos políticos', 'Empresas de tecnologia', 'Movimentos sociais urbanos', 'Organismos internacionais'],
                correct: 2
            },
            {
                text: 'O alto índice de informalidade no trabalho na América do Sul significa que a maior parte dos empregos criados está em condições:',
                options: ['De pleno emprego e estabilidade', 'Sem garantias ou segurança para o trabalhador', 'De atuação em empresas multinacionais', 'Com salários acima da média'],
                correct: 1
            },
            {
                text: 'A segregação socioespacial é visível em cidades como Recife (PE), onde se observa a coexistência de:',
                options: ['Prédios comerciais e industriais', 'Praias e resorts de luxo', 'Moradias precárias e edifícios de classe média/alta', 'Parques e áreas verdes'],
                correct: 2
            },
            {
                text: 'Quais são as duas línguas majoritárias da população na América do Sul, herança do período colonial?',
                options: ['Inglês e Francês', 'Alemão e Italiano', 'Espanhol e Português', 'Holandês e Sueco'],
                correct: 2
            },
            {
                text: 'O conceito de "Exploração", ligado à colonização, está diretamente relacionado a qual atividade econômica da época?',
                options: ['Criação de universidades', 'Fomento à indústria local', 'Extração de recursos naturais (mineração e outros)', 'Desenvolvimento de alta tecnologia'],
                correct: 2
            },
            {
                text: 'O aspecto socioeconômico de "Salário - exportação" é uma característica da:',
                options: ['Independência política', 'Crescimento da indústria de base', 'Dependência econômica', 'Proteção ambiental'],
                correct: 2
            },
            {
                text: 'A Mestiçagem na população sul-americana é o resultado da miscigenação entre, principalmente, quais grupos?',
                options: ['Europeus e Asiáticos', 'Europeus, Indígenas e Africanos', 'Europeus e Americanos do Norte', 'Somente Indígenas e Africanos'],
                correct: 1
            },
            {
                text: 'O estudo de "Recursos Naturais" na América do Sul inclui, principalmente, a presença de:',
                options: ['Clima frio', 'Mineração, cobre, ouro, ferro e vegetação', 'Grandes desertos', 'Baixa biodiversidade'],
                correct: 1
            },
            {
                text: 'Quais atividades agrárias estão listadas como importantes na teia de conhecimento?',
                options: ['Caça e pesca em alto-mar', 'Extrativismo vegetal e silvicultura', 'Agricultura e Pecuária', 'Biotecnologia e nanotecnologia'],
                correct: 2
            },
            {
                text: 'A questão da desigualdade e da pobreza é um aspecto socioeconômico que afeta o continente desde:',
                options: ['O início da Guerra Fria', 'O século XXI', 'O período colonial (países historicamente desiguais)', 'A Segunda Guerra Mundial'],
                correct: 2
            },
            {
                text: 'Qual é o principal objetivo dos projetos de transporte, como a rede de teleféricos de La Paz, em regiões com obstáculos geográficos severos?',
                options: ['Atrair turistas', 'Facilitar a mineração', 'Melhorar a mobilidade e integração urbana', 'Reduzir o custo da energia'],
                correct: 2
            },
            {
                text: 'A palavra "crioulo(a)", relacionada à população, historicamente se referia aos filhos de:',
                options: ['Africanos no Brasil', 'Indígenas na América Central', 'Espanhóis nascidos na América', 'Franceses no Caribe'],
                correct: 2
            },
            {
                text: 'O conceito de "Refinação de recursos" na Colônia era geralmente feito:',
                options: ['Na própria América, incentivando a indústria', 'Por meio de cooperativas indígenas', 'Nas metrópoles europeias (Portugal e Espanha)', 'Em fábricas dos Estados Unidos'],
                correct: 2
            },
            {
                text: 'O Mercosul é um tipo de bloco econômico conhecido como:',
                options: ['Zona de Livre Comércio', 'União Política', 'União Aduaneira', 'Mercado Comum'],
                correct: 2
            },
            {
                text: 'O bloco que foi criado em 1948 com o objetivo de promover a paz, a democracia e os direitos humanos entre os 35 países americanos é a(o):',
                options: ['OEA (Organização dos Estados Americanos)', 'ONU', 'Aladi', 'Opep'],
                correct: 0
            },
            {
                text: 'Qual bloco de livre comércio foi substituído pelo USMCA em 2020?',
                options: ['Alca', 'CAN', 'Nafta', 'Alba-TCP'],
                correct: 2
            },
            {
                text: 'O bloco que visa promover a integração política, econômica e de infraestrutura dos países sul-americanos e que entrou em suspensão em 2017 é a(o):',
                options: ['Unasul (União de Nações Sul-Americanas)', 'Mercosul', 'Aladi', 'CAN'],
                correct: 0
            },
            {
                text: 'A Opep (Organização dos Países Exportadores de Petróleo) é uma organização que busca:',
                options: ['Unificar a moeda europeia', 'Promover a integração cultural', 'Coordenar e unificar as políticas petrolíferas', 'Gerenciar a produção de cobre'],
                correct: 2
            },
            {
                text: 'A sigla CAN (Comunidade Andina de Nações) foi criada para promover a integração econômica, política e social entre quais países, principalmente?',
                options: ['Brasil, Argentina, Uruguai', 'EUA, México, Canadá', 'Bolívia, Colômbia, Equador, Peru', 'Nigéria, Irã, Arábia Saudita'],
                correct: 2
            },
            {
                text: 'A ALBA-TCP (Aliança Bolivariana para os Povos de Nossa América) tem como principal foco:',
                options: ['A livre circulação de capitais', 'A criação de um banco privado', 'A ênfase no social, na saúde e na diminuição da desigualdade', 'A construção de grandes rodovias'],
                correct: 2
            },
            {
                text: 'A Aladi (Associação Latino-Americana de Integração) tem o objetivo primordial de:',
                options: ['Criar um banco de desenvolvimento', 'Focar na área militar', 'Estabelecer, progressivamente, um mercado comum latino-americano', 'Unificar o sistema de transportes'],
                correct: 2
            },
            {
                text: 'O principal objetivo da OEI (Organização dos Estados Ibero-Americanos) é o avanço nos campos da:',
                options: ['Economia e Comércio', 'Educação, Ciência, Tecnologia e Cultura', 'Esportes e Lazer', 'Agricultura e Pecuária'],
                correct: 1
            },
            {
                text: 'Em 2020, o Chile era um membro associado, mas não pleno, de qual importante bloco sul-americano?',
                options: ['OTCA', 'Opep', 'Mercosul', 'Caricom'],
                correct: 2
            },
            {
                text: 'O principal objetivo da OTCA (Organização do Tratado de Cooperação Amazônica) é proteger:',
                options: ['O petróleo do Oriente Médio', 'O meio ambiente e o desenvolvimento sustentável da Amazônia', 'Os interesses comerciais dos EUA', 'A produção de carros elétricos'],
                correct: 1
            },
            {
                text: 'Qual organismo de integração regional reúne 12 nações do Caribe e busca a integração econômica, social e política?',
                options: ['CAN', 'Unasul', 'Aladi', 'Caricom (Comunidade do Caribe)'],
                correct: 3
            },
            {
                text: 'A Aladi (Associação Latino-Americana de Integração) tem o objetivo primordial de:',
                options: ['Criar um banco de desenvolvimento', 'Focar na área militar', 'Estabelecer, progressivamente, um mercado comum latino-americano', 'Unificar o sistema de transportes'],
                correct: 2
            },
            {
                text: 'O desemprego estrutural é aquele causado principalmente:',
                options: ['Por crises econômicas passageiras', 'Pela falta de investimento público', 'Pela modernização das fábricas e substituição do trabalho por máquinas', 'Pelo avanço da agricultura'],
                correct: 2
            },
            {
                text: 'O Prosul (Fórum para o Progresso e Integração da América do Sul) foi lançado em 2019 com a proposta de ser mais leve e flexível que a:',
                options: ['OEA', 'Unasul', 'Mercosul', 'CAN'],
                correct: 1
            },
            {
                text: 'Qual é o órgão financeiro criado com o objetivo de apoiar o desenvolvimento dos países membros, especialmente em projetos de setores como infraestrutura e sustentabilidade?',
                options: ['FMI', 'OEA', 'Banco de desenvolvimento (NBD - Novo Banco de Desenvolvimento)', 'Banco Mundial'],
                correct: 2
            },
            {
                text: 'O Sistema de União Monetária mais bem-sucedido do mundo é:',
                options: ['O Dólar americano', 'A Libra esterlina', 'O Euro', 'O Yuan chinês'],
                correct: 2
            },
            {
                text: 'A diferença entre a Linha Azul e a Linha Verde na rede de teleféricos de La Paz (Bolívia) é que elas interligam:',
                options: ['Diferentes bairros nobres', 'Apenas zonas rurais', 'Diferentes pontos da região metropolitana (interligando diferentes altitudes)', 'Aeroportos internacionais'],
                correct: 2
            },
            {
                text: 'A guerra ao crime organizado é citada na página 94 como uma das ações que podem ajudar a:',
                options: ['Aumentar a informalidade', 'Reduzir o comércio exterior', 'Melhorar a qualidade de vida e diminuir a violência nas cidades latino-americanas', 'Diminuir o índice de escolaridade'],
                correct: 2
            },
            {
                text: 'A ALCA (Área de Livre Comércio das Américas) não foi concretizada. Qual era o seu principal objetivo?',
                options: ['A união aduaneira da América do Sul', 'A criação de um parlamento regional', 'A eliminação gradual das barreiras alfandegárias entre todos os países das Américas', 'A coordenação das políticas petrolíferas'],
                correct: 2
            },

             { text: 'O termo "gentrificação" descreve o processo de revitalização de áreas urbanas que resulta na valorização do local e, consequentemente, na:', options: ['Diminuição do custo de vida', 'Aumento da população de baixa renda', 'Expulsão de moradores de baixa renda', 'Aumento de espaços verdes'], correct: 2 },
            { text: 'A "cidade informal" ou "precária" se desenvolve principalmente pela incapacidade do setor formal de absorver a força de trabalho, resultando em moradias sem:', options: ['Conexão com a internet', 'Acesso a mercados próximos', 'Regularização fundiária e infraestrutura básica', 'Áreas de lazer e entretenimento'], correct: 2 },
            { text: 'Qual é a principal diferença entre o desemprego conjuntural e o desemprego estrutural?', options: ['Um é causado por crises econômicas, o outro por modernização tecnológica', 'Um afeta o setor de serviços, o outro o industrial', 'Um é sazonal, o outro é permanente', 'Um afeta trabalhadores qualificados, o outro não qualificados'], correct: 0 },
            { text: 'O crescimento urbano desordenado, a partir do século XX na América do Sul, está diretamente ligado a qual fenômeno social e econômico?', options: ['Queda nas taxas de natalidade', 'Êxodo rural em larga escala', 'Aumento do turismo internacional', 'Obrigatoriedade de morar nas cidades'], correct: 1 },
            { text: 'A "segregação socioespacial" é uma das marcas da urbanização latino-americana, onde as classes sociais se separam no espaço urbano. Qual é a principal consequência disso para a população mais pobre?', options: ['Melhor acesso a serviços públicos', 'Maior integração social', 'Pior acesso a empregos, saúde e educação', 'Redução da informalidade'], correct: 2 },
            { text: 'A "dependência econômica" dos países da América do Sul em relação a nações mais desenvolvidas é uma herança colonial que se perpetuou pelo modelo de:', options: ['Indústria pesada', 'Comércio triangular', 'Economia primário-exportadora', 'Economia de serviços'], correct: 2 },
            { text: 'Qual foi o principal objetivo das reformas urbanas no final do século XIX, como a do Rio de Janeiro, que, na prática, levou à expulsão da população pobre do centro?', options: ['Combater a criminalidade', 'Embelezar a cidade e modernizá-la', 'Reduzir a população total', 'Fomentar a habitação popular'], correct: 1 },
            { text: 'O conceito de "Mestiçagem" na América do Sul não se limita apenas à mistura biológica, mas também a qual processo cultural?', options: ['Homogeneização cultural', 'Sincretismo religioso e cultural', 'Isolamento de tradições', 'Supressão de idiomas'], correct: 1 },
            { text: 'A teia de conhecimento menciona que a "colonização de exploração" resultou em países com "sociedades desiguais". Qual o principal fator que contribuiu para essa desigualdade?', options: ['Adoção de diferentes idiomas', 'A concentração de terras e riquezas nas mãos de poucos', 'A falta de recursos naturais', 'A escassez de mão de obra'], correct: 1 },
            { text: 'O "comércio" no período colonial era um monopólio. Quem detinha esse monopólio e como isso afetava a economia da colônia?', options: ['As colônias, que controlavam as exportações', 'Os indígenas, que controlavam as rotas comerciais', 'As metrópoles, que controlavam o que era comprado e vendido', 'Os Estados Unidos, que controlavam o comércio internacional'], correct: 2 },
            { text: 'A criação do Mercosul como "união aduaneira" significa que os países membros adotaram uma TEC (Tarifa Externa Comum). O que a TEC faz?', options: ['Isenta todos os produtos de impostos', 'Aplica a mesma tarifa para produtos importados de fora do bloco', 'Cria impostos internos entre os membros', 'Permite que cada país negocie tarifas separadamente'], correct: 1 },
            { text: 'A UNASUL, que se propunha a ser uma organização intergovernamental para a integração sul-americana, entrou em suspensão. Qual foi a principal razão para isso?', options: ['Crise econômica', 'Divergências ideológicas e políticas entre os líderes', 'Guerra civil entre membros', 'Adesão de novos membros'], correct: 1 },
            { text: 'O acordo comercial entre os EUA, México e Canadá (USMCA) substituiu o NAFTA. Qual a principal alteração desse novo acordo?', options: ['Aumento de tarifas para todos os membros', 'Redução da proteção de direitos autorais', 'Novas regras para a indústria automobilística', 'Inclusão de países da América do Sul'], correct: 2 },
            { text: 'Qual organismo de integração é considerado o mais antigo do hemisfério ocidental e tem sede em Washington, D.C.?', options: ['OEA', 'ALADI', 'CAN', 'CARICOM'], correct: 0 },
            { text: 'A "desigualdade" é uma herança colonial. Qual grupo social, na hierarquia colonial, tinha o maior poder e privilégios?', options: ['Indígenas e escravos', 'Mestiços e crioulos', 'Crioulos', 'Chapetones'], correct: 3 },
            { text: 'O Movimento dos Trabalhadores Rurais Sem Terra (MST) e o Movimento dos Trabalhadores Sem Teto (MTST) se diferenciam principalmente pelo foco de sua luta. Qual a diferença?', options: ['O MST luta por reforma agrária no campo; o MTST por moradia digna nas cidades', 'O MST luta por acesso a crédito; o MTST por transporte público', 'O MST é um movimento urbano; o MTST é um movimento rural', 'O MST luta contra a informalidade; o MTST luta contra o desemprego'], correct: 0 },
            { text: 'O texto sobre "infraestrutura de transportes" na América do Sul aponta que, em muitos países, o sistema é de má qualidade e caro. A culpa é atribuída a qual modelo de gestão?', options: ['Gestão pública com pouco investimento', 'Gestão privada com monopólios', 'Gestão mista, pública e privada', 'Gestão cooperativa'], correct: 1 },
            { text: 'O conceito de "salário-exportação" no modelo de desenvolvimento sul-americano significa que o salário do trabalhador é baixo, o que tem um impacto direto em qual outro fator?', options: ['Aumento do poder de compra', 'Aumento das exportações', 'Aumento da dívida externa', 'Diminuição do mercado interno'], correct: 3 },
            { text: 'A "Crise Hídrica" é um problema ambiental urbano. Qual é uma das causas principais desse problema nas grandes cidades?', options: ['Aumento da área rural', 'Consumo excessivo e falta de planejamento', 'Uso de energia eólica', 'Chuva excessiva'], correct: 1 },
            { text: 'A OEI, Organização dos Estados Ibero-americanos, tem foco na educação, ciência, tecnologia e cultura, reunindo países da América Latina, Espanha e qual outro país europeu?', options: ['Portugal', 'França', 'Itália', 'Alemanha'], correct: 0 },
            { text: 'A ALBA-TCP, Aliança Bolivariana para os Povos de Nossa América, se diferencia por ter uma perspectiva ideológica que prioriza a cooperação e solidariedade em oposição a qual modelo econômico?', options: ['Liberalismo', 'Socialismo', 'Capitalismo', 'Comunismo'], correct: 2 },
            { text: 'A principal diferença entre uma "Zona de Livre Comércio" e uma "União Aduaneira" é a presença da:', options: ['Livre circulação de pessoas', 'Tarifa Externa Comum', 'Moeda única', 'Política externa comum'], correct: 1 },
            { text: 'Qual organismo de integração, que tem como membros países da América do Sul e o México, foca no desenvolvimento de um "mercado comum" a longo prazo?', options: ['MERCOSUL', 'ALADI', 'UNASUL', 'OEA'], correct: 1 },
            { text: 'O termo "subemprego" se refere a trabalhadores que estão empregados, mas que não conseguem ter uma renda suficiente para cobrir os gastos essenciais. É um problema muito presente em áreas urbanas de qual região?', options: ['América do Sul', 'Europa Ocidental', 'América do Norte', 'Japão'], correct: 0 },
            { text: 'A "crise hídrica" e a "poluição" são problemas ambientais urbanos na América Latina, resultado da falta de:', options: ['Árvores', 'Esgoto e saneamento básico', 'Planejamento e gestão de recursos', 'Carros elétricos'], correct: 2 },
            { text: 'A "guerra ao crime organizado" é citada como uma das medidas para combater a violência. No entanto, o texto aponta que essa medida é incompleta sem a ação em qual outro setor?', options: ['Turismo', 'Educação e social', 'Agrícola', 'Industrial'], correct: 1 },
            { text: 'O Chile, citado na página 115, é um membro associado do Mercosul. O que isso significa para o país?', options: ['Ele não participa das reuniões', 'Ele tem acesso a tarifas especiais, mas não assina a TEC', 'Ele é um membro pleno com direito a voto', 'Ele é um observador sem poder decisório'], correct: 1 },
            { text: 'A Opep, Organização dos Países Exportadores de Petróleo, teve sua fundação motivada por qual objetivo principal?', options: ['Reduzir o preço do petróleo', 'Controlar a produção e garantir a estabilidade dos preços', 'Aumentar a concorrência no mercado', 'Promover a energia renovável'], correct: 1 },
            { text: 'A teia de conhecimento relaciona o "Colonialismo" com o "Salário - exportação", mostrando que o baixo custo da mão de obra era usado para:', options: ['Melhorar o mercado interno', 'Aumentar a competitividade das exportações', 'Aumentar o poder de compra', 'Aumentar a diversificação econômica'], correct: 1 },
            { text: 'Qual das seguintes cidades latino-americanas é um exemplo de metrópole com alta segregação socioespacial?', options: ['Montevidéu', 'Assunção', 'Recife', 'Havana'], correct: 2 },
            { text: 'O termo "mão de obra escrava", na teia de conhecimento, refere-se principalmente à exploração de quais grupos?', options: ['Somente indígenas', 'Somente europeus', 'Indígenas e africanos', 'Somente africanos'], correct: 2 },
            { text: 'A teia de conhecimento na página 99, ao falar de recursos naturais, menciona "Solo Fértil" e "Água". Qual atividade econômica se beneficia diretamente desses recursos?', options: ['Mineração', 'Pecuária', 'Indústria', 'Silvicultura'], correct: 1 },
            { text: 'O que o texto da página 92 quer dizer quando se refere a "crescimento caótico" na América do Sul?', options: ['Crescimento econômico acelerado', 'Aumento desordenado da população nas cidades', 'Criação de parques e áreas verdes', 'Aumento de transportes públicos'], correct: 1 },
            { text: 'O "subemprego", que afeta a maioria dos trabalhadores na América do Sul, tem um impacto direto em qual outro problema social?', options: ['Aumento do poder de compra', 'Aumento das taxas de emprego formal', 'Diminuição da informalidade', 'Pobreza e baixa qualidade de vida'], correct: 3 },
            { text: 'O Prosul (Fórum para o Progresso e Integração da América do Sul), criado em 2019, foi uma iniciativa para substituir qual bloco, considerado ineficiente e burocrático?', options: ['OEA', 'UNASUL', 'ALADI', 'MERCOSUL'], correct: 1 },
            { text: 'A "segregação socioespacial" em áreas urbanas pode ser vista na diferença entre o acesso a serviços públicos entre a população de bairros ricos e a de áreas periféricas, como:', options: ['Acesso a transporte privado', 'Acesso a hospitais e escolas de qualidade', 'Acesso a carros de luxo', 'Acesso a internet de banda larga'], correct: 1 },
            { text: 'A OEA, Organização dos Estados Americanos, possui quais dois objetivos principais, além de promover a democracia e os direitos humanos?', options: ['Cooperação econômica e desenvolvimento social', 'Cooperação militar e política', 'Comércio e segurança', 'Integração cultural e esportiva'], correct: 0 },
            { text: 'O Chile e o Peru são membros plenos da Comunidade Andina (CAN). Qual a principal característica da CAN?', options: ['É um mercado comum', 'É um bloco de livre comércio', 'É uma união aduaneira', 'É uma aliança política'], correct: 2 },
    // adicione mais perguntas aqui se quiser
  ];

  /**********************
   * Estado e elementos
   **********************/
  let questions = []; // embaralhadas
  let timePerQuestion = 20;
  let currentIndex = 0;
  let score = 0;
  let wrongs = [];
  let timerInterval = null;
  let remaining = 0;
  let paused = false;

  // elementos DOM
  const startScreen = document.getElementById('startScreen');
  const startBtn = document.getElementById('startBtn');
  const resumeBtn = document.getElementById('resumeBtn');
  const viewRankingBtn = document.getElementById('viewRankingBtn');
  const timePerQuestionSel = document.getElementById('timePerQuestion');

  const quizCard = document.getElementById('quizCard');
  const questionText = document.getElementById('questionText');
  const optionsEl = document.getElementById('options');
  const progressBar = document.getElementById('progressBar');
  const progressText = document.getElementById('progressText');
  const timerBar = document.getElementById('timerBar');
  const timerText = document.getElementById('timerText');
  const scoreMini = document.getElementById('scoreMini');
  const nextBtn = document.getElementById('nextBtn');
  const skipBtn = document.getElementById('skipBtn');
  const quitBtn = document.getElementById('quitBtn');

  const resultCard = document.getElementById('resultCard');
  const resultMsg = document.getElementById('resultMsg');
  const finalScore = document.getElementById('finalScore');
  const totalQ = document.getElementById('totalQ');
  const wrongList = document.getElementById('wrongList');
  const shareBtn = document.getElementById('shareBtn');
  const tryAgainBtn = document.getElementById('tryAgainBtn');
  const backHomeBtn = document.getElementById('backHomeBtn');

  const rankingCard = document.getElementById('rankingCard');
  const rankingList = document.getElementById('rankingList');
  const viewRanking = document.getElementById('viewRankingBtn');
  const clearRankingBtn = document.getElementById('clearRankingBtn');
  const closeRankingBtn = document.getElementById('closeRankingBtn');

  // botão retomar
  const resumeButton = document.getElementById('resumeBtn');

  /**********************
   * Utilitários
   **********************/
  function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

  function saveState(){
    const state = { questions, timePerQuestion, currentIndex, score, wrongs, remaining, paused };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function loadState(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return null;
    try { return JSON.parse(raw); } catch(e){ return null; }
  }

  function clearState(){
    localStorage.removeItem(STORAGE_KEY);
  }

  function addHistoryEntry(sc){
    const raw = localStorage.getItem(HISTORY_KEY);
    const arr = raw ? JSON.parse(raw) : [];
    arr.unshift({ score: sc, total: questions.length, date: new Date().toISOString() });
    // guarda só últimos 20
    localStorage.setItem(HISTORY_KEY, JSON.stringify(arr.slice(0,20)));
  }

  function getHistory(){ const raw = localStorage.getItem(HISTORY_KEY); return raw ? JSON.parse(raw) : []; }

  /**********************
   * Tela Inicial / start
   **********************/
  function showStartScreen(){
    startScreen.classList.remove('hidden');
    quizCard.classList.add('hidden');
    resultCard.classList.add('hidden');
    rankingCard.classList.add('hidden');

    // se existe estado salvo, habilita retomar
    const st = loadState();
    if(st) resumeBtn.classList.remove('hidden'); else resumeBtn.classList.add('hidden');
  }

  // inicia um novo jogo
  function initNewQuiz(){
    timePerQuestion = Number(timePerQuestionSel.value) || 20;
    questions = shuffleArray([...ALL_QUESTIONS]).map(q => ({
      text: q.text,
      // vamos embaralhar opções mantendo index correto
      options: shuffleArray(q.options.map((opt, idx) => ({ opt, idx })))
    })).map(q=>{
      // recuperar index da correta
      // find original correct index (we'll map original ALL_QUESTIONS by text)
      const original = ALL_QUESTIONS.find(originalQ => originalQ.text === q.text);
      const correctIdxOriginal = ALL_QUESTIONS.indexOf(original) >=0 ? original.correct : 0;
      // but above mapping is tricky; simpler approach: during map maintain correct value via matching:
      return q;
    });

    // simpler rebuild: ensure correct mapping by rebuilding from ALL_QUESTIONS with shuffle
    questions = shuffleArray(ALL_QUESTIONS).map(item => {
      const shuffledOptions = shuffleArray(item.options.map((opt, idx)=> ({ opt, idx })));
      // determine index in shuffledOptions where idx === item.correct
      const correctShuffledIndex = shuffledOptions.findIndex(o => o.idx === item.correct);
      return {
        text: item.text,
        options: shuffledOptions.map(o=>o.opt),
        correct: correctShuffledIndex
      };
    });

    currentIndex = 0;
    score = 0;
    wrongs = [];
    remaining = timePerQuestion;
    paused = false;
    saveState();
    openQuiz();
  }

  function openQuiz(){
    startScreen.classList.add('hidden');
    quizCard.classList.remove('hidden');
    resultCard.classList.add('hidden');
    rankingCard.classList.add('hidden');
    renderQuestion();
    startTimer();
  }

  /**********************
   * Retomar (carregar estado salvo)
   **********************/
  function tryResume(){
    const st = loadState();
    if(!st) return alert('Nenhum progresso salvo.');
    // recuperar perguntas (já vêm do storage)
    questions = st.questions;
    timePerQuestion = st.timePerQuestion || 20;
    currentIndex = st.currentIndex || 0;
    score = st.score || 0;
    wrongs = st.wrongs || [];
    remaining = st.remaining || timePerQuestion;
    paused = !!st.paused;
    timePerQuestionSel.value = timePerQuestion;
    openQuiz();
    resumeBtn.classList.add('hidden');
  }

  /**********************
   * Render / lógica
   **********************/
  function renderQuestion(){
    // verificar índice
    if(currentIndex >= questions.length){
      finishQuiz();
      return;
    }

    const q = questions[currentIndex];
    questionText.textContent = q.text;
    optionsEl.innerHTML = '';

    q.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.className = 'option-btn option-button bg-gray-50 border border-transparent rounded-xl px-4 py-3 text-left w-full flex items-center gap-3';
      btn.innerHTML = `<span class="flex-1">${opt}</span><span class="ml-2 opacity-0 transition-opacity" aria-hidden="true"></span>`;
      btn.dataset.index = i;

      // teclado: Enter / Space
      btn.addEventListener('keydown', e => { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); } });

      btn.addEventListener('click', () => {
        // se já desabilitado
        if(btn.classList.contains('disabled')) return;
        handleAnswer(i, btn);
      });

      optionsEl.appendChild(btn);
    });

    updateProgressUI();
    scoreMini.textContent = `Acertos: ${score}`;
    timerText.textContent = `Tempo: ${remaining}s`;
    timerBar.style.width = `${(remaining/timePerQuestion)*100}%`;
    nextBtn.classList.add('hidden');
  }

  function updateProgressUI(){
    const pct = Math.round((currentIndex / questions.length) * 100);
    progressBar.style.width = pct + '%';
    progressText.textContent = `Questão ${Math.min(currentIndex+1, questions.length)} de ${questions.length} (${pct}%)`;
  }

  /**********************
   * Temporizador
   **********************/
  function startTimer(){
    stopTimer();
    timerInterval = setInterval(() => {
      if(paused) return;
      remaining--;
      if(remaining < 0) remaining = 0;
      timerText.textContent = `Tempo: ${remaining}s`;
      timerBar.style.width = `${(remaining/timePerQuestion)*100}%`;
      saveState();

      if(remaining === 0){
        // tempo esgotou = contar como erro e avançar
        markTimeout();
      }
    }, 1000);
  }

  function stopTimer(){
    if(timerInterval) { clearInterval(timerInterval); timerInterval = null; }
  }

  function markTimeout(){
    // revelar resposta correta e marcar erro
    const q = questions[currentIndex];
    const optionsButtons = [...optionsEl.children];
    optionsButtons.forEach((btn, i) => {
      btn.classList.add('disabled');
      if(i === q.correct){
        btn.classList.add('correct');
        const icon = document.createElement('span'); icon.textContent = ' ✅'; btn.appendChild(icon);
      }
    });
    // registrar como errado
    wrongs.push({ question: q.text, chosen: null, correct: q.options[q.correct] });
    nextBtn.classList.remove('hidden');
    stopTimer();
    saveState();
  }

  /**********************
   * Resposta do usuário
   **********************/
  function handleAnswer(selectedIndex, btn){
    const q = questions[currentIndex];
    const buttons = [...optionsEl.children];
    // desabilita todos
    buttons.forEach(b => { b.classList.add('disabled'); });
    // marca seleção
    if(selectedIndex === q.correct){
      btn.classList.add('correct');
      btn.style.background = '#dcfce7';
      score++;
      const tick = document.createElement('span'); tick.textContent = ' ✅'; tick.className='ml-2'; btn.appendChild(tick);
    } else {
      btn.classList.add('incorrect');
      btn.style.background = '#fee2e2';
      const cross = document.createElement('span'); cross.textContent = ' ❌'; cross.className='ml-2'; btn.appendChild(cross);
      // mostra o correto
      const correctBtn = buttons[q.correct];
      if(correctBtn){
        correctBtn.classList.add('correct');
        const tick = document.createElement('span'); tick.textContent = ' ✅'; tick.className='ml-2'; correctBtn.appendChild(tick);
      }
      wrongs.push({ question: q.text, chosen: q.options[selectedIndex], correct: q.options[q.correct] });
    }

    // pequeno delay para salvar e permitir ver o feedback
    stopTimer();
    nextBtn.classList.remove('hidden');
    saveState();
  }

  /**********************
   * navegar próximas / pular / sair
   **********************/
  nextBtn.addEventListener('click', () => {
    currentIndex++;
    remaining = timePerQuestion;
    saveState();
    if(currentIndex < questions.length){
      renderQuestion();
      startTimer();
    } else {
      finishQuiz();
    }
  });

  skipBtn.addEventListener('click', () => {
    // marcar como pulo = tratado como errada sem chosen
    const q = questions[currentIndex];
    wrongs.push({ question: q.text, chosen: null, correct: q.options[q.correct] });
    currentIndex++;
    remaining = timePerQuestion;
    saveState();
    if(currentIndex < questions.length){
      renderQuestion();
      startTimer();
    } else {
      finishQuiz();
    }
  });

  quitBtn.addEventListener('click', () => {
    if(confirm('Deseja realmente sair e salvar seu progresso para retomar depois?')) {
      saveState();
      showStartScreen();
    }
  });

  /**********************
   * Finalizar quiz / resultados
   **********************/
  function finishQuiz(){
    stopTimer();
    saveState(); // guarda estado final
    // mostrar resultados
    quizCard.classList.add('hidden');
    resultCard.classList.remove('hidden');

    finalScore.textContent = score;
    totalQ.textContent = questions.length;
    // mensagem personalizada
    const pct = Math.round((score / questions.length) * 100);
    let msg = '';
    if(pct === 100) msg = 'Perfeito! Você domina o assunto. 👏';
    else if(pct >= 80) msg = 'Excelente! Muito bem.';
    else if(pct >= 50) msg = 'Bom trabalho — continue praticando.';
    else msg = 'Não desanime — prática leva à melhora!';

    resultMsg.textContent = msg;

    // lista de erradas
    wrongList.innerHTML = '';
    if(wrongs.length){
      const h = document.createElement('h4'); h.className='font-semibold text-red-600'; h.textContent = 'Questões que você errou:'; wrongList.appendChild(h);
      wrongs.forEach(w => {
        const div = document.createElement('div');
        div.className = 'mt-2 p-3 bg-red-50 rounded';
        div.innerHTML = `<p class="text-sm"><strong>❓ ${w.question}</strong></p>
                         <p class="text-xs text-red-600">Sua resposta: ${w.chosen ?? '— (não respondeu)'}</p>
                         <p class="text-xs text-green-700">Resposta certa: ${w.correct}</p>`;
        wrongList.appendChild(div);
      });
    } else {
      const p = document.createElement('p'); p.className='text-green-700 font-semibold'; p.textContent = '🎉 Você não errou nenhuma questão!';
      wrongList.appendChild(p);
    }

    // salvar histórico e limpar estado salvo
    addHistoryEntry(score);
    clearState();
    renderRanking(); // atualiza ranking na memória
  }

  /**********************
   * Compartilhar / ranking
   **********************/
  shareBtn.addEventListener('click', async () => {
    const text = `Fiz o Quiz e acertei ${score} de ${questions.length} perguntas!`;
    if(navigator.share){
      try { await navigator.share({ title:'Meu resultado', text }); }
      catch(e){ alert('Compartilhamento cancelado.'); }
    } else {
      // fallback: link whatsapp
      const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`;
      window.open(url, '_blank');
    }
  });

  tryAgainBtn.addEventListener('click', () => { initNewQuiz(); });
  backHomeBtn.addEventListener('click', () => { showStartScreen(); });

  viewRankingBtn.addEventListener('click', () => {
    startScreen.classList.add('hidden');
    quizCard.classList.add('hidden');
    resultCard.classList.add('hidden');
    rankingCard.classList.remove('hidden');
    renderRanking();
  });

  closeRankingBtn.addEventListener('click', () => {
    showStartScreen();
  });

  clearRankingBtn.addEventListener('click', () => {
    if(confirm('Limpar todo o histórico de pontuações?')) {
      localStorage.removeItem(HISTORY_KEY);
      renderRanking();
    }
  });

  function renderRanking(){
    const hist = getHistory();
    rankingList.innerHTML = '';
    if(!hist.length){
      rankingList.innerHTML = '<p class="text-gray-500">Nenhuma pontuação registrada.</p>';
      return;
    }
    hist.forEach((h, i) => {
      const li = document.createElement('li');
      const date = new Date(h.date);
      li.className = 'py-2 border-b last:border-b-0';
      li.innerHTML = `<strong>#${i+1}</strong> — <span class="ml-2 font-semibold">${h.score}/${h.total}</span> <span class="ml-2 text-xs text-gray-500">(${date.toLocaleString()})</span>`;
      rankingList.appendChild(li);
    });
  }
  
  /**********************
   * Início / eventos de UI
   **********************/
  startBtn.addEventListener('click', () => { initNewQuiz(); });
  resumeBtn.addEventListener('click', tryResume);
  timePerQuestionSel.addEventListener('change', (e) => { /* só muda na nova sessão */ });

  // checar se existe estado salvo para habilitar retomar
  (function init(){
    const st = loadState();
    if(st) resumeBtn.classList.remove('hidden'); else resumeBtn.classList.add('hidden');
    renderRanking();
  })();

  </script>
</body>
</html>





























































